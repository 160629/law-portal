function createXMLHttp(){if(window.XMLHttpRequest){return(new XMLHttpRequest())}var a=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var b=0;b<a.length;b++){try{xmlhttp_ver=a[b];return new ActiveXObject(a[b])}catch(c){}}return null}function Ajax(a,b){this.url=a;this.param=[];this.dataParam=[];this.method="POST";this.encoding=Ajax.encoding||"utf-8";this.async=b||false;this.xmlParam="";this.submitParam=null;this.isHTML=false;this.submitType="xml";this.dataType=EOS.dataType;this.isCommonUrl=false;this.reset()}Ajax.prototype.setDataType=function(a){this.dataType=a||"xml";if(a==="json"){this.submitType="json"}};Ajax.prototype.initParam=function(){if(this.dataType=="json"){this.setDataType("json");var b={params:{},data:{}};EOS.apply(b.params,EOS.json.objectArrayToJson(this.param));EOS.apply(b.data,this.xmlParam);EOS.apply(b.data,EOS.json.objectArrayToJson(this.dataParam));this.submitParam=b}else{var e="";var d="<root>";for(var c=0;c<this.param.length;c++){var g=this.param[c];e+="<param><key>"+xmlConversion(g.key)+"</key><value>"+xmlConversion(g.value)+"</value></param>"}d+="<params>"+e+"</params>\n";var f=this.xmlParam;if(this.dataParam&&this.dataParam.length>0){for(var c=0,a=this.dataParam.length;c<a;c++){var h=this.dataParam[c];f+=h.value}}if(f&&f.indexOf("<root><data>")==0){f=f.substr("<root><data>".length);f=f.substr(0,f.lastIndexOf("</data></root>"))}d+="<data>"+f+"</data></root>";this.submitParam=d}};Ajax.prototype.setAsync=function(a){if(a==null){a=true}this.async=a};Ajax.prototype.wrapperUrl=function(){if(this.isCommonUrl){return this.url}var c=[];if(this.dataType=="json"){var b=this.submitParam.params;for(var a in b){c.push([a,"=",b[a]].join(""))}}c.push(["____r=",new Date()].join(""));return[this.url,this.dataType=="json"?".ext":".ajax","?",c.join("&")].join("")};Ajax.prototype.wrapperData=function(){if(this.dataType=="json"){var a=this.submitParam.data;var f=this.submitParam.params;if(f){for(var c in f){a[c]=f[c]}}var e=EOS.json.toJSONString(a);if(e=="{}"){return""}return e}else{var b=this.submitParam;if(typeof this.submitParam=="object"){b=EOS.json.toXMLString(this.submitParam)}return'<?xml version="1.0" encoding="'+this.encoding+'"?>'+encodeURIComponent(b)}};Ajax.prototype.setRequestHeaders=function(){if(isMoz&&this.xmlHttp.overrideMimeType){this.xmlHttp.overrideMimeType("text/html;charset=utf-8")}if(this.dataType=="json"){this.xmlHttp.setRequestHeader("Content-Type","application/json;charset="+this.encoding)}else{this.xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset="+this.encoding)}this.xmlHttp.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlHttp.setRequestHeader("_eosAjax",this.submitType);this.xmlHttp.setRequestHeader("encoding",this.encoding)};Ajax.prototype.reset=function(){this.retDom=null;this.responseText=null;this.xmlHttp=createXMLHttp()};Ajax.prototype.cancel=function(){if(!this.running){return this}this.running=false;this.xmlHttp.abort();this.reset();return this};Ajax.prototype.isSuccess=function(){return !!!this.getException()};Ajax.prototype.onSuccess=function(){};Ajax.prototype.onFailure=function(a){alert(AJAX_EXCEPTION+"\n\n"+a)};Ajax.prototype.callBack=function(){var d=false,c=null;var b=this.getExceptionInvalid();if(b===true||b==="true"){c=this.getLoginPage();if(c){d=true}b=AJAX_EXCEPTION_INVALID+"\n\n"+this.url}else{b=this.getExceptionMessage()||this.getException()}if(d){if(window.contextPath&&c.indexOf(window.contextPath+"/")!=0){c=window.contextPath+(c.indexOf("/")==0?"":"/")+c}var a=_get_top_window();a.location=c;return}if(b&&this.onFailure){return this.onFailure(b)}return this.onSuccess()};Ajax.prototype.onStateChange=function(){if(!this.xmlHttp||this.xmlHttp.readyState!=4||!this.running){return}try{$debug("\n return XML:\n "+EOSLog.formatXML(this.xmlHttp.responseText));this.responseText=this.xmlHttp.responseText;this.status=this.xmlHttp.readyState;if(this.dataType=="json"){eval("var r="+this.responseText);this.retJson=r}else{this.retDom=createXmlDom();this.retDom.loadXML(this.responseText)}return this.callBack.apply(this,arguments)}catch(e){$handle(e);return this.onFailure(e)}finally{this.running=false;this.xmlHttp.onreadystatechange=function(){}}};Ajax.prototype.getParam=function(b){for(var a=0;a<this.param.length;a++){var c=this.param[a];if(c.key==b){return c.value}}};Ajax.prototype.setOutParam=function(a){this.addParam("__outParam",a)};Ajax.prototype.setParamsInfo=function(a){this.addParam("__paramsInfo",a)};Ajax.prototype.setInoutParam=function(a){this.addParam("__inoutParams",a)};Ajax.prototype.getOutParam=function(){return this.getParam("__outParam")};Ajax.prototype.getParamsInfo=function(){return this.getParam("__paramsInfo")};Ajax.prototype.getInoutParam=function(){return this.getParam("__inoutParams")};Ajax.prototype.submit=function(a){if(this.url&&this.url.lastIndexOf(".beanx")==this.url.length-(".beanx").length){this.isCommonUrl=true}else{if(this.url&&this.url.lastIndexOf(".cservice")==this.url.length-(".cservice").length){this.isCommonUrl=true}else{if(this.url&&this.url.lastIndexOf(".__temp_service")==this.url.length-(".__temp_service").length){var q=this.url.lastIndexOf("/");var n=this.url.lastIndexOf(".kservice");var b=this.url.substring(q+1,n);q=b.lastIndexOf(".");var f=b.substring(0,q);var m=b.substring(q+1);if(!this.xmlParam){var c=this.getParam("__outParam");var h=this.getParam("__inoutParams");var d=this.getParam("__paramsInfo");var l=[];if(!d){d=[];for(var s=0;s<this.param.length;s++){var k=this.param[s];d.push(k.key)}d=d.join(",")}if(d.indexOf(",__outParam")==-1){d+=",__outParam"}if(d.indexOf(",__inoutParams")==-1){d+=",__inoutParams"}var g=d.split(",");for(var o=0;o<g.length;o++){var x=g[o];l.push(this.getParam(x))}l.push(d);this.param=[];this.xmlParam=ServiceCaller.submitXMLTemplate(f,m,ServiceCaller.getSubmitXML(l))}}}}this.running=true;this.encoding=a||this.encoding;this.initParam();try{var u=this.wrapperUrl();this.xmlHttp.open(this.method,u,this.async);var w=this.wrapperData();var v=this;if(this.async){this.xmlHttp.onreadystatechange=function(){v.onStateChange.apply(v,arguments)}}this.setRequestHeaders();$debug("submit url:"+this.url+"\n submit XML:\n"+EOSLog.formatXML(w));if(this.dataType=="json"){this.xmlHttp.send(w||null)}else{this.xmlHttp.send("__ajaxParam="+encodeURIComponent(w))}if(!this.async){return this.onStateChange()}}catch(t){$error("xmlHttp ajax request error.");this.running=false}};Ajax.prototype.getXMLDom=function(){if(this.retDom){return this.retDom}};Ajax.prototype.getJSON=function(){if(this.retJson){return this.retJson}};Ajax.prototype.getText=function(){if(this.xmlHttp){return this.xmlHttp.responseText}};Ajax.prototype.getValue=function(a){if(this.retDom==null){return null}if(a==null||a==""){return null}var b=this.retDom.selectSingleNode(a);if(b!=null){return getNodeValue(b)}else{return null}};Ajax.prototype.getValues=function(c){var b=new Array();if(this.retDom==null){return b}if(c==null||c==""){return b}var a=this.retDom.selectNodes(c);for(var d=0;d<a.length;d++){var e=a[d];b[d]=getNodeValue(e)}return b};Ajax.prototype.getDataset=function(a,b){var b=b||a;var c=new Dataset(b);c.init(this.retDom.selectNodes(a))};Ajax.prototype.setForm=function(c,d){for(var a=0;a<c.elements.length;a++){var b=c.elements[a];this.setObjectValue(b,null,d)}};Ajax.prototype.setObjectValue=function(c,g,d){if(!(c)||c==null){return}var f=g;if(f==null){if(c.name&&c.name!=null&&c.name!=""){if(d!=null){f=d+"/"+c.name}else{f=c.name}}}if(!(c.type)){if(f==null){if(c.name&&c.name!=""){f=c.name}else{if(c.id&&c.id!=""){f=c.id}}}if(f!=null){var h=this.getProperty(f);if(h!=null){c.innerText=h}}return}if(f!=null){if(c.type=="text"||c.type=="hidden"){var h=this.getProperty(f);if(h!=null){c.value=h}return}if(c.type=="radio"||c.type=="checkbox"){var e=this.dom.selectNodes("root/data/"+f);for(var b=0;b<e.length;b++){if(c.value==e[b].text){c.checked=true}else{c.checked=false}}return}if(c.type=="select-one"){var h=this.getProperty(f);for(var b=0;b<c.options.length;b++){if(h==c.options[b].value){c.options[b].selected=true}}return}if(c.type=="select-multiple"){var l=this.getValues("root/data/"+f);if(l.length>0){for(var b=0;b<c.options.length;b++){c.options[b].selected=false;for(var a=0;a<l.length;a++){if(l[a]==c.options[b].value){c.options[b].selected=true}}}}return}}};Ajax.prototype.Updater=function(b){this.isHTML=true;this.submitType="html";this.submit("utf-8");var c=this.retDom.selectSingleNode("root/data");var a=getNodeValue(c);setInnerHTML(b,a)};Ajax.prototype.addParam=function(a,b){if(b&&b.toXMLString){this.setDataType("xml");b.name=a;this.dataParam.push({key:a,value:b.toXMLString()})}else{this.param.push({key:a,value:b})}};Ajax.prototype.clearParam=function(){this.param=[]};Ajax.prototype.getProperty=function(a){if(this.retDom==null){return null}if(a==null||a==""){return null}var b=this.retDom.selectSingleNode("root/data/"+a);if(b!=null){return getNodeValue(b)}else{return null}};Ajax.prototype.submitForm=function(d,c){var f="";d=$id(d);for(i=0;i<d.elements.length;i++){var b=d.elements[i];if(b.type=="radio"||b.type=="checkbox"){if(!b.checked){continue}}if(b.type=="application/x-shockwave-flash"){continue}var a=d.elements[i].name||d.elements[i].id;var e=getElementValue(d.elements[i]);if(a){this.addParam(a,e)}}this.submit(c);if(this.retDom==null){return false}return true};Ajax.prototype.loadData=function(a){this.submitXML(a)};Ajax.prototype.submitXML=function(b,a){if(b){if(this.dataType=="xml"&&typeof(b)=="object"){b=EOS.json.toXMLString(b)}this.xmlParam=b}this.submit(a)};Ajax.prototype.getResponseXMLDom=function(){return this.retDom};Ajax.prototype.getReturnNodeValue=function(b){var c=this.getResponseXMLDom();var a=c?c.selectNodes(b):null;if(a&&a.length>0){return getNodeValue(a[0])}return null};Ajax.prototype.getException=function(){var a="/root/exceptions";return this.getReturnNodeValue(a)};Ajax.prototype.getExceptionCode=function(){var a="/root/exceptions/exception/code";return this.getReturnNodeValue(a)};Ajax.prototype.getExceptionMessage=function(){var a="/root/exceptions/exception/message";return this.getReturnNodeValue(a)};Ajax.prototype.getExceptionInvalid=function(){var a="/root/exceptions/invalid";return this.getReturnNodeValue(a)};Ajax.prototype.getLoginPage=function(){var a="/root/exceptions/loginPage";var b=this.getReturnNodeValue(a);b=b?trim(b+""):null;return b};var HideSubmit=Ajax;function ServiceCaller(){this.service_URL_SUFFIX=".service";this.ajax=null;this.encoding="utf-8"}ServiceCaller.submitXMLTemplate=function(d,c,a){var b=["<root><data>","	<ajaxCall>","		<serviceName>"+xmlConversion(d)+"</serviceName>","		<operateName>"+xmlConversion(c)+"</operateName>","		<params>",a||"","		</params>","		<return></return>","		<exception></exception>","	</ajaxCall>","</data></root>"];return b.join("\n")};ServiceCaller.getParamesArray=function(b,e,a){var d=[];b=b||[];a=a||b.length;for(var c=e;c<a;c++){d.push(b[c])}return d};ServiceCaller.returnConversion=function(f){var e=f.getAttribute("__category");var d=f.getAttribute("__type");if(e=="xml"){return f.xml}else{if(e=="entity"){return Dataset.initEntity(f)}else{if(e=="dataset"){var g=new Dataset(f.tagName);g.init(f.childNodes);return g}else{if(e=="collection"){var b=f.selectNodes("./entry");var a=[];for(var c=0;c<b.length;c++){var f=b[c];if(f.nodeType==1){a.push(getNodeValue(f))}}return a}}}}return getNodeValue(f)};ServiceCaller.parameConversion=function(g){var f=null,e=null;var h=typeof(g);var b="primeval";var a={data:"",type:b};if(g===null||g===undefined){e="null"}else{if(g===""){e="empty"}}if(e){a.data='<value __isNullOrEmpty="'+e+'" />';a.type=b;return a}if(h=="string"||h=="number"||h=="boolean"){b="primeval";a.data=xmlConversion(""+g)}else{if(h=="object"&&g.xml&&(g.async===false||g.async===true)){b="xml";a.data=g.xml}else{if(g instanceof Entity){b="entity";a.data=g.toXMLString(false)}else{if(h=="object"&&g.tagName&&g.tagName.toUpperCase()=="FORM"){g=getFormElementsValue(g)}if(g instanceof Dataset){g=g.getEntities()}if(g instanceof Array){b="collection";f=[];for(var d=0;d<g.length;d++){f.push(ServiceCaller.parameConversion(g[d]).data)}a.data=f.join("\n")}else{b="form";f=[];for(var c in g){f.push("<property>");f.push("<key>");f.push(xmlConversion(c));f.push("</key>");f.push("<value>");f.push(xmlConversion(g[c]+""));f.push("</value>");f.push("</property>")}a.data=f.join("\n")}}}}a.data=(b=="collection"||b=="form")?a.data:"<value>"+a.data+"</value>";a.type=b;return a};ServiceCaller.getSubmitXML=function(a){var c=[];for(var b=0;b<a.length;b++){result=ServiceCaller.parameConversion(a[b]);c.push('<param __category="'+result.type+'">');c.push(result.data);c.push("</param>")}return c.join("\n")};ServiceCaller.prototype.callBack=function(){var d=false,c=null;var b=this.getExceptionInvalid();if(b===true||b==="true"){c=this.getLoginPage();if(c){d=true}b=AJAX_EXCEPTION_INVALID+"\n\n"+this.serviceName+"."+this.operateName}else{b=this.getExceptionMessage()||this.getException()}if(d){if(window.contextPath&&c.indexOf(window.contextPath+"/")!=0){c=window.contextPath+(c.indexOf("/")==0?"":"/")+c}var a=_get_top_window();a.location=c;return}if(b&&this.onFailure){return this.onFailure(b)}this.onSuccess();return this.getReturnValue()};ServiceCaller.prototype._callCore=function(d,c,f,b,a){this.ajax=new Ajax(d+this.service_URL_SUFFIX,f);this.ajax.callBack=b||this.ajax.callBack;var e=ServiceCaller.getSubmitXML(a);this.serviceName=d;this.operateName=c;this.ajax.submitXML(ServiceCaller.submitXMLTemplate(d,c,e),this.encoding)};function form2Object(a,b){var g={};g=getFormElementsValue(a);var e=g;if(b){e={};b=b+"";b=b.lastIndexOf("/")==b.length-1?b:b+"/";if(b.indexOf("[*]")<0){for(var h in g){if(h.indexOf(b)==0){e[h]=g[h]}}}else{var c=false;for(var h in g){for(var d=1;d<Number.MAX_VALUE;d++){var f=b.replace("[*]","["+d+"]");if(h.indexOf(f)==0){e[h]=g[h];break}}}}}return e}ServiceCaller.prototype.call=function(c,b,a){this._callCore(c,b,false,null,ServiceCaller.getParamesArray(arguments,2));return this.callBack()};ServiceCaller.prototype.isSuccess=function(){return !!!this.getException()};ServiceCaller.prototype.onSuccess=function(){};ServiceCaller.prototype.onFailure=function(a){alert(AJAX_EXCEPTION+"\n\n ServiceCaller : "+a)};ServiceCaller.prototype.callAsyn=function(c,b,a){var d=this;this._callCore(c,b,true,function(){d.callBack()},ServiceCaller.getParamesArray(arguments,2))};ServiceCaller.prototype.getResponseXMLDom=function(){return this.ajax.getResponseXMLDom()};ServiceCaller.prototype.getReturnValue=function(f,g){var c="/root/data/ajaxCall/return/value";g=g||this.getResponseXMLDom();var b=g?g.selectNodes(c):[];var a=[];for(var d=0;d<b.length;d++){var e=b[d];if(e.nodeType==1){e=f===false?e:ServiceCaller.returnConversion(e);a.push(e)}}if(a.length==0){a=null}return a};ServiceCaller.prototype.getReturnNodeValue=function(a){return this.ajax?this.ajax.getReturnNodeValue(a):null};ServiceCaller.prototype.getReturn=function(){var a="/root/data/ajaxCall/return";return this.getReturnNodeValue(a)};ServiceCaller.prototype.getException=function(){var a="/root/data/ajaxCall/exceptions/ecxeption";return this.getReturnNodeValue(a)};ServiceCaller.prototype.getExceptionMessage=function(){var a="/root/data/ajaxCall/exceptions/exception/message";return this.getReturnNodeValue(a)};ServiceCaller.prototype.getExceptionCode=function(){var a="/root/data/ajaxCall/exceptions/exception/code";return this.getReturnNodeValue(a)};ServiceCaller.prototype.getExceptionInvalid=function(){var a="/root/data/ajaxCall/exceptions/invalid";return this.getReturnNodeValue(a)};ServiceCaller.prototype.getLoginPage=function(){var a="/root/data/ajaxCall/exceptions/loginPage";var b=this.getReturnNodeValue(a);b=b?trim(b+""):null;return b};