function RTree(g,d,a,e){var f=new RTreeModel();f.hasRoot=e;var c=new RTreeView(g,f,d,a);f.setNodeExpandAction=_rtreemodel_setNodeExpandAction;f.getNodeExpandAction=_rtreemodel_getNodeExpandAction;f.getExpandRetXpaths=_rtreemodel_getExpandRetXpaths;f.initAttachParam=_rtreemodel_initAttachParam;f.getTreeNodeName=_rtreemodel_getTreeNodeName;f.getTreeNodeIcon=_rtreemodel_getTreeNodeIcon;f.setEntityInfo=_rtreemodel_setEntityInfo;f.getEntityInfo=_rtreemodel_getEntityInfo;f.showNodeMenu=_rtreemodel_showNodeMenu;f.addMenuItem=_rtreemodel_addMenuItem;f.onmenuclick=_rtreemodel_onmenuclick;f.getMovemenu=_rtreemodel_getMovemenu;f.isNodeMovable=_rtreemodel_isNodeMovable;f.moveNode=_rtreemodel_moveNode;f.setMoveAction=_rtreemodel_setMoveAction;f.getMoveAction=_rtreemodel_getMoveAction;f.getMoveParam=_rtreemodel_getMoveParam;f.clearup=_rtreemodel_clearup;f.setExpandInitParamFunc=_rtreemodel_setExpandInitParamFunc;f.setMoveInitParamFunc=_rtreemodel_setMoveInitParamFunc;f.expandRoot=_rtreemodel_expandRoot;f.treeView=c;f.nodeExpandActions=new Object();f.entityInfos=new Object();f.move_node=null;f.moveto_node=null;if(!isIE){var b=$id(g.getAttribute("id")+"_container")}return c}var RTreeModel=function(){};EOS.override(RTreeModel,{dataType:EOS.dataType,getExpandParam:function(b){var g=b.entity.name;var j=this.getEntityInfo(g);var k=j.InitExpandParamFunc;var h=j.submitXpath;var d="";var e;d=fireUserEvent(k,[b]);var f=this.dataType=="json"?"toJson":"toString";if(h==""||h==null){e=b.entity[f]()}else{var a=b.entity.name;b.entity.name=h;e=b.entity[f]();b.entity.name=a}if(this.dataType=="json"){var c={};EOS.apply(c,d);EOS.apply(c,e);return c}else{return"<root><data>"+e+d+"</data></root>"}},renderNode:function(b){var f=b.ds;if(!f){return}var l=f.values;if(!b.isroot){if(l.length==0){b.hasChild=false;b.isleaf=true;b.refreshExpendIcon();b.icon.src=b.openIconSrc;b.childrenContainer.style.display="none";b.loadFinished=true;return}else{b.hasChild=true;b.isleaf=false;b.refreshExpendIcon()}}else{if(l.length!=0){b.hasChild=true;b.isleaf=false}}var a,g,c,n,h,k,d,m,e;for(var j=0;j<l.length;j++){var h=j===0?true:false;var k=j===l.length-1?true:false;g=l[j];c=this.getTreeNodeName(g);n=this.getTreeNodeIcon(g.name);e=this.getEntityInfo(g.name).iconType;d=!!(this.getEntityInfo(g.name)).expandAction;a=new RTreeNode(b,c,n,g,h,k,d,this.hasRoot,e);m=this.getEntityInfo(g.name).preload;b.childrenContainer.appendChild(a);if(d&&m){this.preLoad(a,function(o){if(!o.getLength()){a.setLeaf()}})}a.refresh()}b.childrenContainer.style.display="";b.icon.src=b.openIconSrc;b.loadFinished=true},loadNodeChild:function(b,a){var c=this;this.loadNode(b,function(e,d){c.renderNode(d);if(a){a(d)}})},loadNode:function(a,c){if(a.isloadData){c(a,a.dataset)}var d=this.getNodeExpandAction(a);var b=this.getExpandParam(a);var e=this.getExpandRetXpaths(a);if(!(d&&e)){a.icon.src=a.openIconSrc;a.loadFinished=true;return}var g=new HideSubmit(d);var h=a.entity.name;var j=this.getEntityInfo(h);if(j.queryReturnValue){g.setOutParam(j.queryReturnValue)}if(j.queryParamsInfo){g.setParamsInfo(j.queryParamsInfo)}if(j.queryInoutParams){g.setInoutParam(j.queryInoutParams)}var f=this;g.onSuccess=function(){var q=null;if(this.dataType=="json"){var o=j.childEntityXpaths;var m=g.retJson;var l;for(var n=0,k=o.length;n<k;n++){l=m[o[n]];if(l){var p=Json2Dataset(l,o[n]);if(q){q.appendDataset(p)}else{q=p}}}q=q||new Dataset()}else{var r=g.getXMLDom();var q=Dataset.create(r,"root/data/"+e[0]);for(var n=1;n<e.length;n++){q.appendDataset(Dataset.create(r,"root/data/"+e[n]))}}a.ds=q;c(q,a)};g.setDataType(this.dataType);g.submitXML(b)},preLoad:function(b,a){this.loadNode(b,function(c){a(c,b)})},clearup:function(){for(var a in this){this[a]=undefined}}});function _rtreemodel_expandRoot(){var a=new RTreeRootNode(new Entity("root"),this);a.level=0;this.treeView.rootNode=a;this.treeView.appendChild(a);this.loadNodeChild(a)}function _rtreemodel_setNodeExpandAction(b,a,d){var c=this.getEntityInfo(b);c.expandAction=a;c.childEntityXpaths=d}function _rtreemodel_setExpandInitParamFunc(b,a){var c=this.getEntityInfo(b);c.InitExpandParamFunc=a}function _rtreemodel_setMoveInitParamFunc(b,a){var c=this.getEntityInfo(b);c.InitMoveParamFunc=a}function _rtreemodel_getNodeExpandAction(b){var a=b.entity.name;var c=this.getEntityInfo(a);return c.expandAction}function _rtreemodel_getExpandRetXpaths(b){var a=b.entity.name;var c=this.getEntityInfo(a);return c.childEntityXpaths}function _rtreemodel_getExpandParam(f){var e=f.entity.name;var h=this.getEntityInfo(e);var d=h.InitExpandParamFunc;var b=h.submitXpath;var c="";var g;c=fireUserEvent(d,[f]);if(b==""||b==null){g=f.entity.toString()}else{var a=f.entity.name;f.entity.name=b;g=f.entity.toString();f.entity.name=a}return"<root><data>"+g+c+"</data></root>"}function _rtreemodel_initAttachParam(a){if(a&&isUserEventDefined(a)){return fireUserEvent(a,[])}else{return""}}function _rtreemodel_getTreeNodeName(a){var b=a.name;var e=this.getEntityInfo(b);var d=e.expression;var c=a.getProperty(d);if(c==null){return d}else{return c}}function _rtreemodel_getTreeNodeIcon(a){var b=this.getEntityInfo(a);return b.iconSrc}function _rtreemodel_getEntityInfo(entityName){entityName=entityName.toLowerCase();var entityInfos=this.entityInfos;var _entityInfo;eval("_entityInfo = entityInfos."+entityName);if(!_entityInfo){_entityInfo=new _rtree_EntityInfo();eval("entityInfos."+entityName+"=_entityInfo;")}return _entityInfo}function _rtreemodel_setEntityInfo(j,a,q,o,n,e,b,g,l,p,k,h,c,f,d){j=j.toLowerCase();var m=this.getEntityInfo(j);m.expression=a;m.iconSrc=q;m.onrefresh=n;m.onclick=o;m.ondblclick=e;m.InitExpandParamFunc=g;m.childEntityXpaths=l;m.expandAction=p;m.iconType=b;m.submitXpath=k;m.preload=h;m.queryReturnValue=c;m.queryParamsInfo=f;m.queryInoutParams=d}function _rtreemodel_setMoveAction(moveEntity,toEntity,bizAction,InitParamFunc,moveReturnValue,moveParamsInfo,moveInoutParams){var moveActions=this.getEntityInfo(moveEntity).moveActions;var index;eval("index = moveActions."+toEntity+";");if(!index){index=moveActions.length;eval("moveActions."+toEntity+" = index;")}var moveObj=new Object();moveObj.action=bizAction;moveObj.InitParamFunc=InitParamFunc;moveObj.moveReturnValue=moveReturnValue;moveObj.moveParamsInfo=moveParamsInfo;moveObj.moveInoutParams=moveInoutParams;moveActions[index]=moveObj}function _rtreemodel_isNodeMovable(b){var c=b.entity.name;var d=this.getEntityInfo(c);var a=d.moveActions;if(a.length>0){return true}else{return false}}function _rtreemodel_moveNode(){if(isCanMoveTo(document.moveModel,document.movetoModel)==false){return}var b=this.move_node;var k=document.movetoModel.moveto_node;this.move_node=null;this.moveto_node=null;this.move_menu.hide();var m=b.getParent();var n=this.getMoveAction(b,k);if(n){var f=b.getTree().beforeMove;if(f){if(f(b,k)==false){return}}var d=this.getMoveParam(b,k);var g=new HideSubmit(n);var h=b.entity.name;var j=this.getEntityInfo(h);if(j.queryReturnValue){g.setOutParam(j.queryReturnValue)}if(j.queryParamsInfo){g.setParamsInfo(j.queryParamsInfo)}if(j.queryInoutParams){g.setInoutParam(j.queryInoutParams)}g.submitXML(d);var l=b.getTree();var c=l.afterMove;if(c){if(l.afterMove(g)==false){return}}var e;var a;e=!b.getParent().isChildOf(k);a=!k.isChildOf(b.getParent());if(e){b.getParent().reloadChild()}if(a){k.reloadChild()}}}function _rtreemodel_getMoveAction(move_node,moveto_node){var toTreeId=findRTree(moveto_node).id;var entityName=move_node.entity.name;var toEntityName=moveto_node.entity.name;var entityInfo=this.getEntityInfo(entityName);var moveActions=entityInfo.moveActions;var index;eval("index = moveActions."+toTreeId+"_"+toEntityName+";");if(typeof(index)!="undefined"){return moveActions[index].action}else{return null}}function _rtreemodel_getMoveParam(move_node,moveto_node){var toTreeId=findRTree(moveto_node).id;var entityName=move_node.entity.name;var toEntityName=moveto_node.entity.name;var entityInfo=this.getEntityInfo(entityName);var InitParamFunc="";var moveActions=entityInfo.moveActions;var index;eval("index = moveActions."+toTreeId+"_"+toEntityName+";");if(typeof(index)!="undefined"){InitParamFunc=moveActions[index].InitParamFunc}var from_node=move_node.getParent();var FuncParam="";FuncParam=fireUserEvent(InitParamFunc,[move_node,moveto_node]);var fromNodeName=from_node.entity.name;var movetoNodeName=moveto_node.entity.name;from_node.entity.name="from";moveto_node.entity.name="to";var returnValue="<root><data>"+FuncParam+this.initParam+from_node.entity+moveto_node.entity+move_node.entity+"</data></root>";from_node.entity.name=fromNodeName;moveto_node.entity.name=movetoNodeName;return returnValue}function _rtreemodel_clearup(){var a=this;a.setNodeExpandAction=null;a.getNodeExpandAction=null;a.getExpandRetXpaths=null;a.getExpandParam=null;a.loadNodeChild=null;a.initAttachParam=null;a.getTreeNodeName=null;a.getTreeNodeIcon=null;a.setEntityInfo=null;a.getEntityInfo=null;a.showNodeMenu=null;a.addMenuItem=null;a.onmenuclick=null;a.getMovemenu=null;a.isNodeMovable=null;a.moveNode=null;a.setMoveAction=null;a.getMoveAction=null;a.getMoveParam=null;a.clearup=null;a.treeView=null;a.attachParam=null;a.nodeExpandActions=null;a.entityInfos=null;a.initParam=null;a.menu=null;a.move_node=null;a.moveto_node=null;a.move_menu=null}function _rtree_EntityInfo(){this.expandAction=null;this.moveActions=new Array();this.childEntityXpaths=[];this.expression="";this.iconSrc="";this.onrefresh="";this.onclick="";this.ondblclick="";this.menuItems=new Array();this.InitMoveParamFunc=null;this.InitExpaneParamFunc=null;this.submitXpath="";return this}function _rtreemodel_addMenuItem(c,b,a){var d=this.getEntityInfo(c);d.menuItems.push(new EOSTreeMenuItem(b,a))}function _rtreemodel_showNodeMenu(f){var a=f.getTree();if(a.beforeShowMenu&&a.beforeShowMenu(f)===false){return}var e=f.entity.name;var g=this.getEntityInfo(e);var d=g.menuItems;if(d.length>0){for(var c=0;c<d.length;c++){if(c!=0){var b=_get_top_window();var h=b.document.createElement("div");h.className="rtree-popmenu-item-line";this.menu.insertItem(h)}this.menu.insertItem(d[c])}a.afterShowMenu&&a.afterShowMenu(f,this.menu);this.menu.show()}}function _rtreemodel_onmenuclick(a){fireUserEvent(a,[this.treeView.cur_node])}function _rtreemodel_getMovemenu(b){if(isIE){if(b.icon){this.move_menu.nodeView.innerHTML=b.icon.outerHTML+b.cell.outerHTML}else{this.move_menu.nodeView.innerHTML=b.cell.outerHTML}var a=this.move_menu.nodeView.getElementsByTagName("span");addClass(a[0],"RC_TREE_CELL");removeClass(a[0],"RC_TREE_ACTIVENODE")}else{if(b.icon){this.move_menu.nodeView.innerHTML="<img style='vertical-align:bottom'src='"+b.icon.src+"'>"+b.cell.innerHTML}else{this.move_menu.nodeView.innerHTML=b.cell.innerHTML}addClass(this.move_menu.nodeView,"RC_TREE_CELL")}this.move_menu.style.display="";this.move_menu.container.style.width=1;this.move_menu.style.width=1;initShadow(this.move_menu.container);if(!isIE){this.move_menu.container.nextSibling.style.zIndex="999";this.move_menu.container.nextSibling.style.width=this.move_menu.offsetWidth+5}this.move_menu.style.display="none";return this.move_menu}function RTreeView(g,c,e,a){var d=g;var b=$id(g.getAttribute("id")+"_container");if(!isIE&&a=="100%"){var f=b;while(true){if(f==null){break}if(f.tagName=="TABLE"&&f.getAttribute("class")=="eos-panel-table"){if(f.getAttribute("height")!=null){b.style.height=a}break}f=f.offsetParent}}else{a=a||b.parentNode.style.height;b.style.height=a}b.style.width=e;d.style.overflow="auto";d.style.width=e;d.style.height=a;d.className="RC_TREE";d.setAttribute("richclientType","RTREE");d.findTreeNode=_rtreeview_findTreeNode;d.expandLevel=_rree_expand_level;d.getRootNode=function(){return this.rootNode};d.getSelectNode=_rree_getSelectNode;d.moveNode=_rtree_move;d.clearup=_rtreeview_clearup;d.model=c;d.cur_node=null;d.onselectstart=function(){return false};d.onselect=function(){return false};d.onmouseup=_rtreeview_onmouseup;d.onmousemove=_rtreeview_onmousemove;d.onmouseout=_rtreeview_onmouseout;d.onkeydown=_rtreeview_onkeydown;d.setMenuStyle=function(h,j){this.model.menu.style[h]=j};d.autoResizeS1=_rree_auto_resize_step1;d.autoResizeS2=_rree_auto_resize_step2;EOS.apply(d,{isInCurrPanel:function(){if(_eos_curr_open_panel!=null){var h=$id(this.getAttribute("id")+"_container").offsetParent;while(true){if(h==null){return false}if(h==_eos_curr_open_panel.table){return true}h=h.offsetParent}}else{return false}},init:function(){var h=this.model;h.menu=new EOSTreeMenu(h);EOSTreeMenu.register(h.menu);h.move_menu=new RTreeMoveMenu();h.expandRoot()}});return d}EOS.override(RTreeView,{});function _rtreeview_findTreeNode(b,e,d){function c(h,j,n,l){var k=h.entity.name;if(k==j){var o=h.entity.getProperty(n);if(o&&(o==l)){return h}}var f=h.getChildren();var m;for(var g=0;g<f.length;g++){m=c(f[g],j,n,l);if(m){return m}}return null}var a=this.rootNode;return c(a,b,e,d)}function _rree_getSelectNode(){return this.cur_node}function _rtree_move(b,j){var l=b.getTree();var k=l.model.getMoveAction(b,j);if(k){var d=l.model.getMoveParam(b,j);var f=new HideSubmit(k);var g=b.entity.name;var h=l.model.getEntityInfo(g);if(h.queryReturnValue){f.setOutParam(h.queryReturnValue)}if(h.queryParamsInfo){f.setParamsInfo(h.queryParamsInfo)}if(this.queryInoutParams){f.setInoutParam(h.queryInoutParams)}f.submitXML(d);var c=l.afterMove;if(c){if(l.afterMove(f)==false){return}}var e;var a;e=!b.getParent().isChildOf(j);a=!j.isChildOf(b.getParent());if(e){b.getParent().reloadChild()}if(a){j.reloadChild()}}}function _rtreeview_clearup(){this.rootNode.clearup();this.model.clearup()}function _rtreeview_onmouseout(){if(!__isStartDrag()){return}if(this.cur_node){this.cur_node.cell.className="RC_TREE_CELL";document.movetoModel=null}}function _rtreeview_onmouseup(){}var doc_onmousemove=null;var doc_onmouseup=null;var doc_onmouseout=null;function _rtreeview_onmousemove(){var a=document.moveModel;if(!__isStartDrag()){return}var b=a.move_menu}function _rtreeview_onkeydown(){function e(g){if(g){sibling=g.nextSibling;if(sibling){return sibling}else{return e(g.getParent())}}else{return null}}function d(j){if(!j){return null}var g=j.getChildren();var h=g.length;if(j.isExpanded()&&(h>0)){return d(g[h-1])}else{return j}}var c=eventManager.getEvent();eventManager.stopPropagation();var b=this;var f=b.cur_node;if(!f){return}switch(c.keyCode){case 40:if(f.getChildren()[0]&&f.isExpanded()){f.getChildren()[0].selected()}else{var a=e(f);if(a){a.selected()}}b.cur_node.scrollIntoView();break;case 38:if(f.previousSibling){var a=d(f.previousSibling);if(a){a.selected()}}else{if(f.getParent()){f.getParent().selected()}}b.cur_node.scrollIntoView();break;case 37:if(f.isExpanded()){f.collapseNode()}else{if(f.getParent()){f.getParent().selected()}}b.cur_node.scrollIntoView();break;case 39:if(!f.isExpanded()){f.expandNode()}else{if(f.getChildren()[0]){f.getChildren()[0].selected()}}b.cur_node.scrollIntoView();break}return false}function RTreeNode(g,a,k,f,j,h,c,d,e){var b=document.createElement("DIV");b.noWrap=true;b.openIconSrc=STREE_DEFAULTOPEN_ICON;b.closeIconSrc=STREE_DEFAULTCLOSE_ICON;b.plusIconSrc="";b.minusIconSrc="";b.isFirstNode=j;b.isLastNode=h;b.hasChild=c;b.imgLevel=g.imgLevel;b.isleaf=!c;b.hasRoot=d;_rtreeNode_processNodeStatus(b,f,j,h,d,k,e,a);b.childLoaded=false;b.entity=f;b.isroot=false;b.addChildNode=_rtreeNode_addChildNodes;b.expandNode=_rtreeNode_expandNode;b.collapseNode=_rtreeNode_collapseNode;b.clearChildren=_rtreeNode_clearChildren;b.selected=_rtreeNode_selected;b.select=_rtreeNode_selected;b.refresh=_rtreeNode_refresh;b.refreshExpendIcon=_rtreeNoderefreshExpendIcon;b.isChildOf=_rtreeNode_isChildOf;b.isExpanded=_rtreeNode_isExpanded;b.getParent=_rtreeNode_getParent;b.getChildren=_rtreeNode_getChildren;b.getTree=_rtreeNode_getTree;b.reloadChild=_rtreeNode_reloadChild;b.clearup=_rtreeNode_clearup;b.getProperty=_rtreeNode_getProperty;b.setIcon=_rtreeNode_setIcon;b.setText=_rtreeNode_setText;b.getText=_rtreeNode_getText;b.setLeaf=_rtreeNode_setLeaf;b.isLeaf=_rtreeNode_isLeaf;b.isRootNode=_rtreeNode_isRoot;b.getEntity=_rtreeNode_getEntity;b.hasChildNode=_rtreeNode_hasChildNode;b.onclick=_rtreenode_onclick;b.ondblclick=_rtreenode_ondblclick;b.oncontextmenu=_rtreenode_oncontextmenu;b.onmousedown=_rtreenode_onmousedown;b.onmouseover=_rtreenode_onmouseover;return b}function _rtreeNode_hasChildNode(){return this.hasChild}function _rtreeNode_getEntity(){return this.entity}function _rtreeNode_isRoot(){return this.isroot}function _rtreeNode_isLeaf(){return this.isleaf}function _rtreeNode_getProperty(a){return this.entity.getProperty(a)}function _rtreeNode_setText(a){this.cell.innerHTML=a}function _rtreeNode_getText(){return this.cell.innerHTML}function _rtreeNode_setIcon(a,b){this.openIconSrc=_rtree_addContextPath(a);if(b){this.closeIconSrc=_rtree_addContextPath(b)}else{this.closeIconSrc=this.openIconSrc}if(this.closeIconSrc=="null"){this.icon.style.display="none"}this.icon.src=this.closeIconSrc}function _rtreeNode_setLeaf(){this.isleaf=true;this.hasChild=false;this.childLoaded=true;this.refreshExpendIcon()}function RTreeRootNode(d,e){var c=e.hasRoot;var a=e.getTreeNodeName(d);var l=e.getTreeNodeIcon(d.name);var b=document.createElement("DIV");b.noWrap=true;var g=document.createElement("DIV");var f;f=document.createElement("IMG");if(l=="null"){f.style.display="none"}if(l==""){l=STREE_DEFAULTOPEN_ICON}else{l=_rtree_addContextPath(l)}b.openIconSrc=l;f.src=l;f.style.verticalAlign="middle";f.ondrag=function(){eventManager.stopPropagation();return false};g.appendChild(f);var k=document.createElement("span");k.innerHTML=a;k.className="RC_TREE_CELL";k.style.verticalAlign="middle";g.appendChild(k);var j=document.createElement("IMG");j.style.verticalAlign="middle";j.src=STREE_BLANK_ICON;g.appendChild(j);var h=document.createElement("DIV");b.appendChild(g);b.appendChild(h);if(!c){g.style.display="none"}b.setAttribute("richclientType","RTREENODE");b.expandIcon=new Object();b.icon=f;b.cell=k;b.childLoaded=false;b.entity=d;b.isroot=true;b.isleaf=false;b.level=false;b.childrenContainer=h;b.imgLevel="";b.addChildNode=_rtreeNode_addChildNodes;b.expandNode=_rtreeNode_expandNode;b.collapseNode=_rtreeNode_collapseNode;b.clearChildren=_rtreeNode_clearChildren;b.selected=_rtreeNode_selected;b.select=_rtreeNode_selected;b.refresh=_rtreeNode_refresh;b.isChildOf=_rtreeNode_isChildOf;b.isExpanded=_rtreeNode_isExpanded;b.getParent=_rtreeNode_getParent;b.getChildren=_rtreeNode_getChildren;b.getTree=_rtreeNode_getTree;b.reloadChild=_rtreeNode_reloadChild;b.clearup=_rtreeNode_clearup;b.isRootNode=_rtreeNode_isRoot;b.getEntity=_rtreeNode_getEntity;b.hasChildNode=_rtreeNode_hasChildNode;b.setText=_rtreeNode_setText;b.getText=_rtreeNode_getText;b.onclick=_rtreenode_onclick;b.ondblclick=_rtreenode_ondblclick;b.oncontextmenu=_rtreenode_oncontextmenu;b.onmousedown=_rtreenode_onmousedown;b.onmouseover=_rtreenode_onmouseover;return b}function _rtree_addContextPath(a){if(a==null){return""}if(a.indexOf("/")==0){return contextPath+a}else{return a}}function _rtreeNode_processNodeStatus(d,j,q,l,g,o,h,b){var a=d.imgLevel;var f=o;var e=h;if(f!=""&&f!="null"){var m=f.split(",");if(e=="xpath"){if(m.length!=2){if(j.getProperty(m[0])!=null){d.openIconSrc=_rtree_addContextPath(j.getProperty(m[0]))}d.closeIconSrc=d.openIconSrc}else{if(j.getProperty(m[0])!=null){d.openIconSrc=_rtree_addContextPath(j.getProperty(m[0]))}if(j.getProperty(m[1])!=null){d.closeIconSrc=_rtree_addContextPath(j.getProperty(m[1]))}}}else{if(m.length!=2){d.openIconSrc=_rtree_addContextPath(m[0]);d.closeIconSrc=d.openIconSrc}else{d.openIconSrc=_rtree_addContextPath(m[0]);d.closeIconSrc=_rtree_addContextPath(m[1])}}}if(a==""&&!g&&q){if(l){d.plusIconSrc=STREE_ROOTPLUS_ICON;d.minusIconSrc=STREE_ROOTMINUS_ICON}else{if(d.hasChild){d.plusIconSrc=STREE_FPLUS_ICON;d.minusIconSrc=STREE_FMINUS_ICON}else{d.plusIconSrc=STREE_FLEAF_ICON;d.minusIconSrc=""}}}else{if(l){if(d.hasChild){d.plusIconSrc=STREE_LPLUS_ICON;d.minusIconSrc=STREE_LMINUS_ICON}else{d.plusIconSrc=STREE_LLEAF_ICON;d.minusIconSrc=""}}else{if(d.hasChild){d.plusIconSrc=STREE_PLUS_ICON;d.minusIconSrc=STREE_MINUS_ICON}else{d.plusIconSrc=STREE_LEAF_ICON;d.minusIconSrc=""}}}var n=document.createElement("DIV");for(var k=0;k<a.length;k++){var c=document.createElement("IMG");c.style.verticalAlign="middle";if(a.charAt(k)=="1"){c.src=STREE_LINE_ICON}else{c.src=STREE_BLANK_ICON}n.appendChild(c)}if(l){d.imgLevel=a+"0"}else{d.imgLevel=a+"1"}var c=document.createElement("IMG");c.src=d.plusIconSrc;c.style.verticalAlign="middle";n.appendChild(c);var o;o=document.createElement("IMG");if(f=="null"){o.style.display="none"}else{o.style.verticalAlign="middle";o.src=d.closeIconSrc}n.appendChild(o);var r=document.createElement("span");r.innerHTML=b;r.className="RC_TREE_CELL";r.style.verticalAlign="middle";n.appendChild(r);var p=document.createElement("DIV");p.style.display="none";d.appendChild(n);d.appendChild(p);d.setAttribute("richclientType","RTREENODE");c.style.cursor="hand";d.expandIcon=c;d.icon=o;d.cell=r;d.childLoaded=false;d.childrenContainer=p}function _rtreeNode_selected(){var a=findRTree(this);if(a.cur_node){a.cur_node.cell.className="RC_TREE_CELL"}this.cell.className="RC_TREE_ACTIVENODE";a.cur_node=this}function _rtreeNoderefreshExpendIcon(){var d=this.imgLevel;var b=this.hasRoot;var c=this.isFirstNode;var a=this.isLastNode;if(this.getParent().isroot&&!b&&c){if(a){this.plusIconSrc=STREE_ROOTPLUS_ICON;this.minusIconSrc=STREE_ROOTMINUS_ICON}else{if(this.hasChild){this.plusIconSrc=STREE_PLUS_ICON;this.minusIconSrc=STREE_MINUS_ICON}else{this.plusIconSrc=STREE_FLEAF_ICON;this.minusIconSrc=STREE_FLEAF_ICON}}}else{if(a){if(this.hasChild){this.plusIconSrc=STREE_LPLUS_ICON;this.minusIconSrc=STREE_LMINUS_ICON}else{this.plusIconSrc=STREE_LLEAF_ICON;this.minusIconSrc=STREE_LLEAF_ICON}}else{if(this.hasChild){this.plusIconSrc=STREE_PLUS_ICON;this.minusIconSrc=STREE_MINUS_ICON}else{this.plusIconSrc=STREE_LEAF_ICON;this.minusIconSrc=STREE_LEAF_ICON}}}this.expandIcon.src=this.minusIconSrc}function _rtreeNode_addChildNodes(a){this.childrenContainer.appendChild(a)}function _rtreeNode_expandNode(c){if(this.isleaf){return}var a=this.getTree().beforeExpand;if(a){if(a(this)==false){return}}var d=this;var g=findRTree(d);var b=g.model;this.expandIcon.src=this.minusIconSrc;if(!d.childLoaded){this.icon.src=RTREE_DROP_LOADING;var f=this;setTimeout(function(){b.loadNodeChild(d,c)},1);d.childLoaded=true}else{if(!d.isleaf){d.childrenContainer.style.display="";this.icon.src=this.openIconSrc}}var e=this.getTree().afterExpand;if(e){e(this)}}function _rtreeNode_collapseNode(){this.expandIcon.src=this.plusIconSrc;this.icon.src=this.closeIconSrc;this.childrenContainer.style.display="none"}function _rtreeNode_clearChildren(){var c=this.childrenContainer.childNodes;for(var b=c.length-1;b>=0;b--){if(!isIE){var a=c[b].parentNode;a.removeChild(c[b])}else{c[b].removeNode(true)}}this.expandIcon.src=RTree.COLLAPS_ICON;this.childrenContainer.style.display="none";this.isleaf=false;this.childLoaded=false;this.isloadData=false}function _rtreeNode_refresh(c){var b=findRTree(this);var d=b.model;if(c){this.entity=c}if(this.isroot){this.level=0}else{this.level=this.getParent().level+1}this.cell.innerHTML=d.getTreeNodeName(this.entity);var e=d.getEntityInfo(this.entity.name);var a=e.onrefresh;if(!a){return}fireUserEvent(a,[this,this.cell])}function _rtreeNode_getParent(){if(this.isroot){return null}else{return this.parentNode.parentNode}}function _rtreeNode_getChildren(){return this.childrenContainer.childNodes}function _rtreeNode_getTree(){return findRTree(this)}function _rtreeNode_isChildOf(a){var b=this;while(b=b.getParent()){if(b==a){return true}}return false}function _rtreeNode_isExpanded(){if(this.childrenContainer.style.display=="none"){return false}else{return true}}function _rtreeNode_reloadChild(a){if(this.childLoaded||this.isRootNode()){this.clearChildren();this.expandNode(a)}else{this.expandNode(a)}}function _rtreeNode_clearup(){var c=this;var b=c.getChildren();for(var a=b.length-1;a>=0;a--){b[a].clearup(true)}c.expandIcon=null;c.icon=null;c.cell=null;c.entity=null;c.childrenContainer=null;c.addChildNode=null;c.expandNode=null;c.collapseNode=null;c.clearChildren=null;c.selected=null;c.refresh=null;c.isChildOf=null;c.isExpanded=null;c.getParent=null;c.getChildren=null;c.getTree=null;c.reloadChild=null;c.clearup=null;c.onclick=null;c.ondblclick=null;c.oncontextmenu=null;c.onmousedown=null;c.onmouseover=null;c.onmouseup=null;c.removeNode(true)}function _rtreenode_onclick(){var b=findRTree(this);var c=b.model;c.menu.hide();function a(){if(d.isleaf){return}if(d.childrenContainer.style.display=="none"){d.expandNode()}else{d.collapseNode()}}var d=this;var f=eventManager.getElement();if(f==this.cell||f==this.expandIcon||f==this.icon){this.selected()}if(f==this.cell){var e=c.getEntityInfo(this.entity.name).onclick;if(e){fireUserEvent(e,[this])}}if(f==this.expandIcon){a()}}function _rtreenode_ondblclick(){eventManager.stopPropagation();var a=findRTree(this);var b=a.model;var c=this;var e=eventManager.getElement();if(e==this.cell){var d=b.getEntityInfo(this.entity.name).ondblclick;if(d){fireUserEvent(d,[this])}}}function _rtreenode_oncontextmenu(){eventManager.stopPropagation();var a=findRTree(this);var b=a.model;var d=b.menu;var c=this;c.selected();if(eventManager.getElement()==this.cell){b.showNodeMenu(c)}return false}function _rtreenode_onmousedown(){var e=eventManager.getEvent();if(!isIE){if(e.button!=0){return}}else{if(e.button!=1){return}}if(!isIE){eventManager.stopPropagation()}var a=eventManager.getElement();if(a!=this.cell){return}var b=findRTree(this);var c=b.model;if(c.isNodeMovable(this)){c.move_node=this;document.moveModel=c;doc_onmousemove=document.onmousemove;doc_onmouseup=document.onmouseup;doc_onmouseout=document.onmouseout;document.onmousemove=function(){d.show();var f=eventManager.getEvent();if(!isIE){d.style.top=eventManager.getPointY();d.style.left=eventManager.getPointX()+12}else{d.style.posTop=f.y+document.body.scrollTop;d.style.posLeft=f.x+document.body.scrollLeft+12}if(isCanMoveTo(document.moveModel,document.movetoModel)!=false){d.statusIcon.src=RTREE_DROP_YES}else{d.statusIcon.src=RTREE_DROP_NO}};document.onmouseup=function(){var f=document.moveModel;if(isCanMoveTo(document.moveModel,document.movetoModel)==false){var g;if(f.move_node.icon.style.display=="none"){g=getPosition(f.move_node.cell)}else{g=getPosition(f.move_node.icon)}if(d.style.display!="none"){d.statusIcon.style.display="none";d.reset(g.top,g.left)}}else{document.onmousemove=doc_onmousemove;document.onmouseup=doc_onmouseup;document.onmouseout=doc_onmouseout;d.hide();f.moveNode();document.moveModel=null;document.movetoModel=null;return}document.onmousemove=doc_onmousemove;document.onmouseup=doc_onmouseup;document.onmouseout=doc_onmouseout;document.moveModel=null;document.movetoModel=null};document.onmouseout=function(){if(!isIE){if(eventManager.getElement().tagName!="HTML"){return}}try{if(!(e.clientX<=0||e.clientX>=document.body.clientWidth||e.clientY<=0||e.clientY>=document.body.clientHeight)){return}var g=getPosition(c.move_node.icon);if(d.style.display!="none"){d.statusIcon.style.display="none";d.reset(g.top,g.left)}document.onmousemove=doc_onmousemove;document.onmouseup=doc_onmouseup;document.onmouseout=doc_onmouseout;document.moveModel=null;document.movetoModel=null}catch(f){}};var d=c.getMovemenu(c.move_node);d.statusIcon.style.display=""}}function _rtreenode_onmouseover(){if(eventManager.getElement()!=this.cell){return}var a=findRTree(this);var b=a.model;if(__isStartDrag()){eventManager.stopPropagation();b.moveto_node=this;document.movetoModel=b;this.selected()}}function _rtreenode_onmouseup(){}function findRTree(a){var b=a;var c;while(b=b.parentNode){c=b.getAttribute("richclientType");if(c=="RTREE"){return b}}return null}function EOSTreeMenu(a){var b=_get_top_window();var d=b.document.createElement("div");var c=b.document.createElement("div");d.appendChild(c);d.container=c;c.className="eos-popmenu";d.style.width="120px";d.style.cursor=" hand";d.style.position="absolute";d.style.display="none";b.document.body.appendChild(d);d.clearItems=_treemenu_clearItems;d.insertItem=_treemenu_insertItem;d.addMenuItem=_treemenu_addMenuItem;d.addMenuLine=function(){var e=document.createElement("div");e.className="rtree-popmenu-item-line";this.container.appendChild(e)};d.removeMenuItem=_treemenu_removeMenuItem;d.hide=function(){this.clearItems();this.style.display="none"};d.show=function(){PageControl.setFocus(this);this.style.display="";initShadow(this.container,b.document);if(!isIE){this.container.nextSibling.style.width=this.container.nextSibling.offsetWidth+5}this.container.nextSibling.style.zIndex="-1";this.style.zIndex="0";if(!isIE){setOpacity(this,0)}this.style.zIndex=999;var f=eventManager.getEvent();if(isIE){this.style.posTop=f.screenY-b.screenTop+b.document.body.scrollTop;this.style.posLeft=f.screenX-b.screenLeft+b.document.body.scrollLeft}else{var e=f.x||f.clientX;var h=f.y||f.clientY;var g=getScreenPos(window,b);e=e+g.left+b.document.body.scrollLeft;h=h+g.top+b.document.body.scrollTop;this.style.top=h;this.style.left=e}this.tabIndex=1;if(!isIE){fx_fadeIn(this,null,500)}};d.model=a;d.oncontextmenu=function(){return false};d.onselectstart=function(){return false};d.onblur=function(){EOSTreeMenu.hideAll()};return d}function _treemenu_addMenuItem(a,b,d){var c=new EOSTreeMenuItem(a,b);this.insertItem(c)}function _treemenu_removeMenuItem(a){var c=this.container.children||this.container.childNodes;for(var b=0;b<c.length;b++){if(c[b].innerHTML==a){if(b<c.length-1){if(c[b+1].className=="rtree-popmenu-item-line"){this.container.removeChild(c[b+1])}}this.container.removeChild(c[b]);return}}}EOSTreeMenu.register=function(a){if(!this.menus){this.menus=new Array()}this.menus.push(a)};EOSTreeMenu.hideAll=function(){if(!this.menus){return}for(var a=0;a<this.menus.length;a++){this.menus[a].hide()}};function EOSTreeMenuItem(b,a){var c=_get_top_window();var d=c.document.createElement("div");d.className="rtree-popmenu-item";if(!isIE){d.style.marginBottom="-6px"}d.innerHTML=b;d.onclickFunction=a;d.onmousedown=_treemenuitem_onclick;d.onmouseover=_treemenuitem_onmouseover;d.onmouseout=_treemenuitem_onmouseout;return d}function _treemenu_clearItems(){var a=this.container.children||this.container.childNodes;if(a){while(a.length>0){this.container.removeChild(a[0])}}}function _treemenu_insertItem(a){this.container.appendChild(a)}function _treemenuitem_onclick(){var a=this.parentNode.parentNode;removeClass(this,"rtree-popmenu-item-mouseover");a.hide();a.model.onmenuclick(this.onclickFunction);this.style.backgroundColor="";this.style.color="black"}function _treemenuitem_onmouseover(){addClass(this,"rtree-popmenu-item-mouseover");this.style.color="white"}function _treemenuitem_onmouseout(){removeClass(this,"rtree-popmenu-item-mouseover");this.style.color="black"}function RTreeMoveMenu(){var c=document.createElement("div");var d=document.createElement("div");var a=document.createElement("nobr");d.appendChild(a);d.className="RC_TREE_DRAGNODE";c.onselectstart=function(){eventManager.stopPropagation();return false};c.style.position="absolute";c.style.display="none";document.body.appendChild(c);var b=document.createElement("img");b.src=RTREE_DROP_NO;b.style.verticalAlign="middle";var e=document.createElement("span");a.appendChild(b);a.appendChild(e);c.appendChild(d);c.nodeView=e;c.statusIcon=b;c.container=d;c.show=_rtreemovemenu_show;c.hide=_rtreemovemenu_hide;c.reset=_rtreemovemenu_reset;return c}function _rtreemovemenu_show(){this.style.display=""}function _rtreemovemenu_reset(c,b){this.hide();return;if(!isIE){this.hide();return}var a=this;if(this.style.posTop==c&&this.style.posLeft==b){this.hide();return}if(this.style.posTop>c){if(this.style.posTop-c<=3){this.style.posTop=this.style.posTop-1}else{this.style.posTop=this.style.posTop-(this.style.posTop-c)*0.3}}if(this.style.posTop<c){if(c-this.style.posTop<=3){this.style.posTop=this.style.posTop+1}else{this.style.posTop=this.style.posTop+(c-this.style.posTop)*0.3}}if(this.style.posLeft>b){if(this.style.posLeft-b<=3){this.style.posLeft=this.style.posLeft-1}else{this.style.posLeft=this.style.posLeft-(this.style.posLeft-b)*0.3}}if(this.style.posLeft<b){if(b-this.style.posLeft<=3){this.style.posLeft=this.style.posLeft+1}else{this.style.posLeft=this.style.posLeft+(b-this.style.posLeft)*0.3}}setTimeout(function(){return _rtreemovemenu_reset.apply(a,[c,b])},10)}function _rtreemovemenu_hide(){this.style.display="none"}function fireUserEvent(function_name,param){var result;var paramstr="";for(i=0;i<param.length;i++){if(i==0){paramstr="param["+i+"]"}else{paramstr=paramstr+",param["+i+"]"}}if(isUserEventDefined(function_name)){eval("result="+function_name+"("+paramstr+");")}if(!result){result=""}return result}function isUserEventDefined(function_name){if(function_name==""||function_name==undefined){return false}var result;eval("result=(typeof("+function_name+')!="undefined");');if(!result){alert(STREE_MOT_FOUND+function_name+"!")}return result}function __isStartDrag(){if(document.moveModel!=null){return true}else{return false}}function isCanMoveTo(a,b){if(!a){return false}if(!b){return false}var d=a.move_node;var c=b.moveto_node;if(c==null){return false}if(d==null){return false}if(d==c){return false}var g=d.getParent();if(c==g){return false}if(c.isChildOf(d)){return false}var e=a.getMoveAction(d,c);var f=d.getTree().isCanMove;if(!e){return false}if(f){if(f(d,c)==false){return false}else{return true}}}function _rree_expand_level(c,b){if(b==null){b=this.getRootNode()}if(!b.isroot){b.expandNode()}var a=this;setTimeout(function(){return isLoadFinish.apply(a,[c,b])},10)}function isLoadFinish(e,d){var a=this;if(d.loadFinished!=true){setTimeout(function(){return isLoadFinish.apply(a,[e,d])},10);return}e=e-1;var c=d.getChildren();if(e==0){return}else{for(var b=0;b<c.length;b++){if(c[b].isleaf){continue}_rree_expand_level(e,c[b])}}}function _rree_auto_resize_step1(){$id(this.id+"_container").style.display="none"}function _rree_auto_resize_step2(){var a=$id(this.getAttribute("id")+"_container");var b=a.parentNode;while(b!=null){if(b.getAttribute&&b.getAttribute("layout")!=null){a.style.height=b.offsetHeight;a.style.display="";b=null}else{b=b.parentNode}}a.style.display=""};