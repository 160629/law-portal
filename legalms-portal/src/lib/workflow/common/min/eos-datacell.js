var DATACELL_STYLE_ROW1="EOS_table_row";var DATACELL_STYLE_ROW2="ROW_STYLE2_NOCSS";var DATE_FORMAT="yyyy-MM-dd";var TIME_FORMAT="HH:mm:ss";var DATETIME_FORMAT="yyyy-MM-dd HH:mm:ss";var PICTURE_BLANK=PICTURE_BLANK||"";function Datacell(a){this.dataType=EOS.dataType;this.id=a;PageControl.add(a,this);this.activeRow=null;this.activeCell=null;this.table=null;this.container=null;this.pilot=null;this.thead=null;this.tbody=null;this.isCount=false;this.queryAction=null;this.xpath=null;this.submitAction=null;this.dataset=null;this.sortParam=null;this.queryParam=null;this.pageParam=null;this.editor=null;this.fields=new Array();this.keys=new Object();this.bodyDiv=null;this.scrollEvent=true;this.fixedLeft=0;this.editorDiv=null;this.editorContainer=null;this.styleEntity=null;this.__subComponent=new Array();this.linkField=null;this.linkId=null;this.filterId=null;this.paramFormId=null;this.rowStyles=[DATACELL_STYLE_ROW1,DATACELL_STYLE_ROW2];this.styleRow=null;this.status=Datacell.STATUS_BLANK;this.isModefied=false;this.cellHeight=20;this.heightExceptBody=23+25;this.headHeight=23;this.toolBarHeight=25;this.scrollDiv=null;this.showIndex=true;this.indexCol=null;this.sortArrow=null;this.__pagePilot=[];this.allowAdd=true;this.allowDel=true;this.readonly=false;this.initParamFunc=null;this.SortByServer=false;this.submitXpath=null;this.minColumnWidth=30;this.toolbarLocation=null;this.toolsList="nav,pagesize,edit,custom,info";this.pageSizeList="none";this.defaultColumnWidth=100;this.topToolbarDiv=$createElement("div",{className:"eos-grid-toolbar"});this.topToolbarDiv.style.display="none";this.bottomToolbarDiv=$createElement("div",{className:"eos-grid-toolbar"});this.topToolbarDiv.style.display="none";this.isFirstLoad=true;this.pageSize=10;this.datacellContainer=null;this.quickEdit=true;this.sortAt="client";this.rowSelectStyleClass="eos-row-selected";this.rowEvenStyleClass="eos-row-even";this.rowStyleClass="eos-row";this.headTextAlign="left";this.width=500;this.height=300;this.queryReturnValue=null;this.queryParamsInfo=null;this.queryInoutParams=null;this.submitReturnValue=null;this.submitParamsInfo=null;this.submitInoutParams=null;this.entityType=null;this.entityName=null}Datacell.prototype.syncRefresh=true;Datacell.prototype.refreshCell=function(b,e){var a=this;var c=b.getAttribute("fieldId");e=e||a.keys[c];if(c==Datacell.__INDEX_NAME||a.beforeRefreshCell(b,e)===false){return}var f=b.firstChild;var d=e.viewType;f.innerHTML=a.createCellValue(b,e)};Datacell.prototype.activeMe=function(){Datacell.activeGrid=this};Datacell.prototype.onPageLoad=function(){PageControl.registerRelation(this.linkId,this.id);var c=this;var b=function a(){c.init();c.loadData();c.refresh();if(!isIE){c.autoResizeS1();c.autoResizeS2()}};if(EOS.loader.isReady){b()}else{EOS.onReady(b)}};Datacell.prototype.createCellValue=function(cell,field){if(!cell){return}var row=cell.parentNode;var entity=this.getEntity(row);var key=cell.getAttribute("fieldId");if(key==Datacell.__INDEX_NAME){return}var field=this.keys[key];var cellText=entity.getProperty(field.fieldName);if(field.onRefreshFunc){if(typeof(field.onRefreshFunc)=="string"){field.onRefreshFunc=eval(field.onRefreshFunc)}cellText=field.onRefreshFunc(cellText,entity,cell.parentNode.rowIndex,cell.cellIndex,this)}else{if(field.expression){cellText=runExpression(field.template,entity)}else{if(field.editor){cellText=htmlConversion(field.editor.getDisplayValue(cellText))}else{cellText=htmlConversion(cellText===undefined||cellText===null?field.nullText:cellText)}}}cellText=cellText===undefined||cellText===null?htmlConversion(field.nullText):cellText;return cellText};Datacell.prototype.clear=function(){if(this.tbody&&this.table){var a=this.tbody.cloneNode(false);this.table.replaceChild(a,this.tbody);this.tbody=a}if(this.dataset){this.dataset.clear()}this.dataset=null;this.styleRow=null};Datacell.prototype.clearup=function(){for(var b in this){try{this[b]=null}catch(a){$handle(a)}}};Datacell.prototype.getField=function(a){if(a===null||a===undefined){return a}if(typeof a=="number"){return this.fields[a]}if(typeof a=="string"){return this.getFieldByName(a)}if(String(a.tagName).toLowerCase()=="td"){var b=a.getAttribute("fieldId");if(b==Datacell.__INDEX_NAME){return null}var c=this.keys[b];return c}return a};Datacell.prototype.getFieldByName=function(b){for(var a=0;a<this.fields.length;a++){if(this.fields[a].fieldName==b){return this.fields[a]}}return null};Datacell.prototype.getFieldsByName=function(c){var b=[];for(var a=0;a<this.fields.length;a++){if(this.fields[a].fieldName==c){b.push(this.fields[a])}}return b};Datacell.prototype.getFieldCount=function(){return this.fields.length};Datacell.prototype.setTitle=function(c,a){c=this.getField(c);if(c){c.labelSpan.innerHTML=a;var b=c.frozeHeadCell;if(b&&b.firstChild&&b.firstChild.firstChild){b.firstChild.firstChild.innerHTML=a}}};Datacell.prototype.setAllowModify=function(b,a){b=this.getField(b);if(b){b.allowModify=a}};Datacell.prototype.copyRow=function(a){return this.cloneEntity(null,a)};Datacell.prototype.cloneEntity=function(a,b){a=a||this.getEntity(b||this.activeRow);if(a){a=a.clone();a.status=Entity.STATUS_NEW}return a};Datacell.prototype.getCellValue=function(a){var e=a.parentNode;var b=e?this.getEntity(e):null;if(b){var d=this.getField(a);var c=d.fieldName;return b.getProperty(c)}return null};Datacell.prototype.setCellValue=function(a,d){if(!a){return false}var f=a.parentNode;var b=f?this.getEntity(f):null;if(b){var e=this.getField(a);var c=e.fieldName;b.setProperty(c,d);this.refreshCell(a);this.refreshRow(f);b.status=Entity.STATUS_MODIFIED;this.isModefied=true;return true}return false};Datacell.prototype.getCell=function(d,a){var b=parseInt(d);if(!isNaN(b)){var c=this.tbody.rows[b];if(c){return this.getCellByRow(c,a)}}return null};Datacell.prototype.getCellByRow=function(d,a){if(isNaN(a)){var c=a;for(var b=0;b<d.cells.length;b++){if(d.cells[b].getAttribute("fieldId")==c){return d.cells[b]}}}else{return d.cells[a]}};Datacell.prototype.getCellAtRow=function(a,b){var c=this.getRowByCell(a);return this.getCellByRow(c,b)};Datacell.prototype.getCellByCurrRow=function(a){if(this.activeRow){return this.getCellByRow(this.activeRow,a)}else{return null}};Datacell.prototype.getRow=function(a){if(typeof a=="number"){return this.getRowAt(a)}if(a.tagName&&a.tagName.toLowerCase()=="td"){return a.parentNode}return a};Datacell.prototype.getRowAt=function(a){try{return this.table.tBodies[0].rows[a]}catch(b){return null}};Datacell.prototype.getRowByCell=function(a){if(a){if(a.parentNode&&a.parentNode.tagName&&a.parentNode.tagName.toLowerCase()=="tr"){return a.parentNode}}return null};Datacell.prototype.getEntityByCell=function(a){var b=this.getRowByCell(a);if(b){return this.getEntity(b)}return null};Datacell.prototype.getCurrRow=function(){return this.activeRow};Datacell.prototype.getValueForEdit=function(a,b){return a.getProperty(b)};Datacell.prototype.init=function(){if(this.inited===true||this.beforeInit()===false){return}if(this.entityType&&!(this.entityType.indexOf("sdo:")==0||this.entityType.indexOf("java:")==0)){this.entityType="sdo:"+this.entityType}this.PAGE_INFO=this.PAGE_INFO||PAGE_INFO;this.PAGE_RECORDINFO=this.PAGE_RECORDINFO||PAGE_RECORDINFO;this.PAGE_INFO_NOCOUNT=this.PAGE_INFO_NOCOUNT||PAGE_INFO_NOCOUNT;this.PAGE_RECORDINFO_NOCOUNT=this.PAGE_RECORDINFO_NOCOUNT||PAGE_RECORDINFO_NOCOUNT;this.activeMe();this.datacellContainer=$id(this.id+"_container");if(this.freezeNumber>0){this.showIndex=true}this.tableMarginLeft=this.showIndex?12:0;this.containerTable=$id(this.id+"_container_table");if(isIE){this.containerTable.className="eos-b-ie "+this.containerTable.className}if((""+this.width).indexOf("%")<1&&(""+this.width).indexOf("p")<1){this.width=parseInt(this.width)+"px"}if((""+this.height).indexOf("%")<1&&(""+this.height).indexOf("p")<1){this.height=parseInt(this.height)+"px"}if(this.freezeNumber&&this.freezeNumber>this.fields.length){this.freezeNumber=this.fields.length}this.paramFormId=this.paramFormId||this.filterId;this.cTop=0;if(!this.toolbarLocation||this.toolbarLocation=="null"){this.containerTD=this.containerTable.tBodies[0].rows[0].cells[0];this.containerTable.tBodies[0].rows[1].style.height="0px";this.containerTable.tBodies[0].rows[1].style.display="none"}else{if(this.toolbarLocation=="top"){this.containerTD=this.containerTable.tBodies[0].rows[1].cells[0];this.toolbarParent=this.containerTable.tBodies[0].rows[0].cells[0];this.toolbarParent.appendChild(this.topToolbarDiv);this.toolbarParent.style.height="25px";this.topToolbarDiv.style.display="block";this.topToolbarDiv.style.borderBottomWidth="1px";this.cTop=this.topToolbarDiv.offsetHeight}else{this.containerTD=this.containerTable.tBodies[0].rows[0].cells[0];this.toolbarParent=this.containerTable.tBodies[0].rows[1].cells[0];this.toolbarParent.appendChild(this.bottomToolbarDiv);this.toolbarParent.style.height="25px";this.bottomToolbarDiv.style.display="block";this.bottomToolbarDiv.style.borderTopWidth="1px"}}this.container=$createElement("div");this.container.className="eos-grid";this.containerTD.appendChild(this.container);this.container.innerHTML="";this.container.style.display="";this.viewport=$createElement("div");this.viewport.className="eos-viewport";this.container.style.width="100%";this.containerTable.style.width=this.width;this.containerTable.style.height=this.height;this.bodyDiv=$createElement("div");this.bodyDiv.className="eos-body-div";this.bodyDivHeight=this.containerTD.offsetHeight-this.headHeight;this.bodyDivHeight=parseInt(this.bodyDivHeight);if(this.bodyDivHeight<0){this.bodyDivHeight=parseInt(this.height)-(this.headHeight+this.toolBarHeight)}if(this.bodyDivHeight>0){this.bodyDiv.style.height=this.bodyDivHeight+"px"}this.headDiv=$createElement("div");this.headDiv.className="eos-head-div";this.headWrap=$createElement("div");this.headDiv.appendChild(this.headWrap);this.container.appendChild(this.viewport);this.cTop=0;if(this.toolbarLocation=="top"){this.topToolbarDiv.style.display="block";this.topToolbarDiv.style.borderBottomWidth="1px";this.cTop=this.topToolbarDiv.offsetHeight}else{this.bottomToolbarDiv.style.display="block";this.bottomToolbarDiv.style.borderTopWidth="1px"}this.viewport.appendChild(this.headDiv);this.viewport.appendChild(this.bodyDiv);this.viewport.style.width=this.width||"100%";this.headDiv.style.width="100%";this.bodyDiv.style.width="100%";this.container.style.display="";this.splitLine=$createElement("div",{className:"eos-split-line"});this.splitLine.style.top=this.cTop+"px";this.container.appendChild(this.splitLine);this.gridMask=$createElement("div",{className:"eos-grid-mask"});this.gridMask.style.width=this.container.style.width;this.gridMask.style.height=this.container.style.height;this.container.appendChild(this.gridMask);this.initPageParam();this.initCSS();this.initHead();this.initFreezeZone();this.initEvent();for(var a=0;a<this.__pagePilot.length;a++){var b=this.__pagePilot[a];b.build()}this.inited=true;this.afterInit()};Datacell.prototype.selectEventRow=function(){var a=eventManager.getElement();var b=getParentByTagName(a,"tr");this.selectRow(b);return b};Datacell.prototype.showCellEditor=function(j,f){if(this.activeEditor&&this.activeCell){this.editorContainer=$id(this.id+"_"+this.activeField.fieldId+"_field_editor_container")||$id(this.activeField.fieldId+"_field_editor_container");var c=this.getEntity(this.activeCell);var j=this.getValueForEdit(c,this.activeField.fieldName);if(this.dict){j=getDictKey(this.dict,j)}try{if(this.editorContainer.parentNode!=document.body){if(!(this.activeField.editor.constructor==window.RichTextEditor&&isIE)){document.body.appendChild(this.editorContainer)}if(this.activeField.editor.constructor==window.RichTextEditor){var a=this.editorContainer.getElementsByTagName("iframe")[0];if(a){this.activeField.editor.editableContainer=a.contentDocument?a.contentDocument.body:a.document.documentElement.body}}}if(isIE){try{if(this.activeField.editor.constructor==window.RichTextEditor){this.editorContainer.style.width="";this.editorContainer.style.height="";this.activeField.editor.container.style.width="900px"}}catch(g){}}this.activeEditor.hideEditor();var i=getPosition(this.activeCell);if(this.activeEditor.setPosition){this.editorContainer.style.display="";this.editorContainer.onmousedown=function(){eventManager.stopEvent()};if(this.activeEditor.tagName=="SELECT"){this.activeEditor.onmousedown=null;this.editorContainer.onmousedown=null}var k=this.activeEditor.tagName;if(isIE&&k&&k.toLowerCase()=="select"){this.activeEditor.style.display=""}this.activeEditor.setPosition(i.left,i.top,this.activeCell.offsetWidth,this.activeCell.offsetHeight);if(isIE&&k&&k.toLowerCase()=="select"){this.activeEditor.style.display="none"}var d={};d.editor=this.activeEditor;d.datacell=this;d.hide=function(m,e,l){if(this.datacell){if(this.editor==(l.target||l.srcElement)){return}this.datacell.hideCellEditor();Datacell.activeGrid=null}};PageControl.addtoStack(d);var b=this;setTimeout(function(){b.activeEditor.showEditor(b);b.editing=true},1)}if(this.activeEditor.xtype=="combo"){this.activeEditor.setValue(j===undefined||j===null?"":j,true);if(this.activeEditor.setDisplayValue){var h=trim(this.activeCell.innerText);this.activeEditor.setDisplayValue(h)}}else{this.activeEditor.setValue(j===undefined||j===null?"":j);if(this.activeEditor.setDisplayValue){var h=trim(this.activeCell.innerText);this.activeEditor.setDisplayValue(h)}}}catch(g){}}};Datacell.prototype.hideCellEditor=function(){if(this.activeCell&&this.activeEditor){if(this.editing){var j=this.activeCell.parentNode;var f=this.activeEditor.getValue();var a=this.activeValue;var b=f;if(a!=b){var g=this.activeCell.getAttribute("fieldId");if(g==Datacell.__INDEX_NAME){return true}if(!this.activeEditor.validate()){this.editing=false;this.unlocked();this.endEdit();return false}if(this.onUpdateRow(this.activeCell.parentNode)){var i=this.onUpdateCell(this.activeCell,this.activeEntity,this.activeField.fieldName,f);(i!==false)&&this.updateEntity(this.activeEntity,this.activeField.fieldName,f);this.refreshAfterEdit();this.isModefied=true;if(this.linkId&&this.linkField){var c=PageControl.getOne(this.linkId);if(c){if(c.activeRow){c.getEntity(c.activeRow).status=Entity.STATUS_MODIFIED}c.refreshAfterEdit();c.isModefied=true}}this.activeValue=f}}this.afterEdit(b,a,this)}else{}this.editing=false;try{this.activeEditor.hideEditor();var h=this.activeEditor}catch(d){}return true}return true};Datacell.prototype.refreshAfterEdit=function(){if(this.syncRefresh){this.refreshRow(this.activeCell?this.activeCell.parentNode:this.activeRow)}else{this.refreshCell(this.activeCell,this.activeField)}};Datacell.prototype.startEdit=function(){if(!this.activeEditor||!this.activeField||!this.activeEntity||!this.activeField.allowModify&&this.activeEntity.status!=Entity.STATUS_NEW){return}this.activeMe();var a=this.getActiveCell();if(this.beforeEdit(a,a.cellIndex,a.parentNode.rowIndex)==false){return}this.editing=true;this.showCellEditor(this.activeValue,this.activeEntity)};Datacell.prototype.endEdit=function(){this.hideCellEditor();this.editing=false;this.beforeShowEditor=false};Datacell.prototype._onKeyDown=function(c){c=c||window.event;var a=this.activeCell;var e=null;var f=c.keyCode;if(f==EOSKey.ESC){eventManager.stopEvent();this.editing=false;this.endEdit()}else{if(f==EOSKey.ENTER){var b=eventManager.getElement();if(b!=null&&b.tagName.toLowerCase()=="textarea"){return}eventManager.stopEvent();if(this.editing){this.endEdit()}else{this.selectRow(a.parentNode);this.startEdit()}}else{if(this.editing&&f==EOSKey.TAB){eventManager.stopEvent();this.endEdit();e=nextElement(a);if(!e){e=nextElement(a.parentNode);if(e){e=e.cells[0]}}this.setActiveCell(c,e);var d=this;window.setTimeout(function(){d.startEdit()},10)}else{if(a&&!this.editing){switch(f){case EOSKey.LEFT:eventManager.stopEvent();e=prevElement(a);if(!e){e=prevElement(a.parentNode);if(e){e=e.cells[e.cells.length-1]}}break;case EOSKey.TAB:case EOSKey.RIGHT:eventManager.stopEvent();this.selectRow(a.parentNode);e=nextElement(a);if(!e){e=nextElement(a.parentNode);if(e){e=e.cells[0]}}break;case EOSKey.DOWN:eventManager.stopEvent();e=nextElement(a.parentNode);if(e){e=e.cells[a.cellIndex]}break;case EOSKey.UP:eventManager.stopEvent();e=prevElement(a.parentNode);if(e){e=e.cells[a.cellIndex]}break}if(e){eventManager.stopEvent();this.setActiveCell(c,e)}}}}}};Datacell.prototype.autoScroll=function(){var h=this.activeCell.offsetLeft+this.tableMarginLeft;var f=h+this.activeCell.offsetWidth+this.tableMarginLeft;var e=this.activeCell.offsetTop;var d=e+this.activeCell.offsetHeight;var i=this.bodyDiv.scrollLeft;var a=this.bodyDiv.scrollTop;var b=i+this.bodyDiv.clientWidth+this.tableMarginLeft;var g=a+this.bodyDiv.clientHeight;var c=this.freezeHeadDiv.offsetWidth;if(h<i){this.bodyDiv.scrollLeft=h-this.tableMarginLeft}else{if(f>b){this.bodyDiv.scrollLeft=i+f-b}}if(e<a){this.bodyDiv.scrollTop=e}else{if(d>g){this.bodyDiv.scrollTop=a+d-g}}};Datacell.prototype.setActiveCell=function(c,b){if(arguments.length==1){if(c!=null&&c.tagName.toLowerCase()=="td"){b=c;c=null}}this.activeMe();c=c||window.event;var a=c?(c.srcElement||c.target):null;b=b||getEventTargetByTagName(c,"td");if(b){var d=b.innerHTML.toLowerCase();if(b!=this.activeCell){this.activeField=this.getField(b);this.activeEditor=this.activeField?this.activeField.editor:null;removeClass(this.activeCell,"eos-cell-actived");if(d.indexOf("<select")<0){addClass(b,"eos-cell-actived")}this.activeCell=b}this.activeEditRow=this.activeCell.parentNode;this.activeEntity=this.getEntity(this.activeEditRow);this.activeEntityBackup=this.activeEntity.clone();if(this.activeEntity&&this.activeField){this.activeValue=this.activeEntity.getProperty(this.activeField.fieldName)}if(d.indexOf("<select")<0){this.autoScroll()}}return b};Datacell.prototype.initEvent=function(){var f=this;function c(k){f.activeMe();f.freezeBodyDiv.style.height=f.bodyDiv.clientHeight+"px";f.syncScroll();if(f.beforeShowEditor!==true){if(f.activeEditor){try{f.activeEditor.hideEditor()}catch(l){}}}f.hideCellEditor()}eventManager.add(this.bodyDiv,"scroll",c);function i(l){f.activeMe();f.endEdit();var e=getEventTargetByTagName(l,"td");var n=e?e.parentNode:null;if(e&&e!==f.containerTD){f.selectRow(n);f.setActiveCell(l,e);f.processCheckBox(l,e);var m=e.cellIndex;var k=n.rowIndex;f.onClickCell(e,m,k,f.activeEntity,f.fields[m],f);f.onClickRow(n,k,f.activeEntity,f);f.beforeShowEditor=true;f.startEdit()}}eventManager.add(this.bodyDiv,"click",i);function h(e){f.activeMe();f.endEdit()}eventManager.add(this.headDiv,"click",h);function j(){f.activeMe()}try{eventManager.add(this.viewport,"mouseup",j);eventManager.add(this.headDiv,"mouseup",j);eventManager.add(this.bodyDiv,"mouseup",j);eventManager.add(this.datacellContainer,"mouseup",j);eventManager.add(this.containerTable,"mouseup",j);eventManager.add(this.container,"mouseup",j);eventManager.add(this.topToolbarDiv,"mouseup",j);eventManager.add(this.bottomToolbarDiv,"mouseup",j);eventManager.add(this.toolbarParent,"mouseup",j)}catch(d){}function g(m){f.activeMe();m=m||window.event;var e=m.srcElement||m.target;eventManager.stopPropagation();if(e&&e.tagName.toLowerCase()!="td"){while((e=e.parentNode)){if(e.tagName&&e.tagName.toLowerCase()=="td"){break}}}if(!e.parentNode){return}var n=e.parentNode.rowIndex;var l=e.cellIndex-1;if(l<0){f.selectRow(f.table.tBodies[0].rows[n],true);return}var k=f.table.tBodies[0].rows[n].cells[l];if(f.activeCell==k){f.activeFreezeCell=e;return}f.activeFreezeCell=e}eventManager.add(this.freezeBodyDiv,"click",g);function b(){Datacell.onWindowResize(f)}if(isIE){if((""+f.width).indexOf("%")>0||(""+f.height).indexOf("%")>0){eventManager.add(window,"resize",b)}}if(isFF){if((""+f.width).indexOf("%")>0||(""+f.height).indexOf("%")>0){if(registerTopContainer(this.datacellContainer)){EOSResizeObjects.push(this)}}}function a(){f.clearup()}eventManager.add(window,"unload",a);if(!Datacell.initGlobalEvent.hasInit){Datacell.initGlobalEvent();Datacell.initGlobalEvent.hasInit=true}};Datacell.prototype.processCheckBox=function(d,c){var a=this;var f=d.srcElement||d.target;if("INPUT"==f.tagName.toUpperCase()){if(f.getAttribute("swidthCheckbox")=="true"&&f.getAttribute("type")=="checkbox"){var b=a.getCellValue(c);var e=a.fields[c.cellIndex];b=b==e.checkedValue?e.unCheckedValue:e.checkedValue;a.setCellValue(c,b)}}};Datacell.prototype.startColumnResize=function(a,c){if(c.allowResize===false){return}a=a||window.event;this.viewportXY=getElementXY(this.viewport);this.isColumnResizing=true;var b=eventManager.getPointX();c.oldRightX=b-this.viewportXY[0];this.splitLine.style.left=c.oldRightX+"px";this.splitLine.style.height=this.viewport.offsetHeight+"px";this.splitLine.style.display="block";this.headDiv.style.cursor="col-resize";this.gridMask.style.cursor="col-resize";this.gridMask.style.display="block";this.gridMask.style.height="100%";this.resizeColumn=c};Datacell.prototype.syncScroll=function(){this.scrollDiv.style.width=this.headTable.offsetWidth;var a=navigator.userAgent.toLowerCase().indexOf("msie 8")!=-1;if(isIE7||a){if(this.bodyDiv.scrollLeft+this.bodyDiv.clientWidth+1>this.bodyDiv.scrollWidth){this.headDiv.scrollLeft=this.bodyDiv.scrollLeft==0?0:this.bodyDiv.scrollLeft+15}else{this.headDiv.scrollLeft=this.bodyDiv.scrollLeft}}else{this.headDiv.scrollLeft=this.bodyDiv.scrollLeft}this.freezeBodyDiv.scrollTop=this.bodyDiv.scrollTop;return};Datacell.prototype.setColumnWidth=function(b,a){b=this.getField(b);a=a<this.minColumnWidth?this.minColumnWidth:a;b.width=a;b.rules.style.width=b.width+"px"};Datacell.prototype.setFieldEditor=function(d,e){d=this.getField(d);var b=null;e=e||d.editId;if(e){b=Datacell.$editor($id(e))}if(!b){var c=$id(this.id+"_"+d.fieldId+"_field_editor_container")||$id(d.fieldId+"_field_editor_container");var a=firstElement(c);if(c&&a){e=a.id;if(e&&e.indexOf("_container")>0){e=e.substring(0,e.length-10);b=Datacell.$editor($o(e)||$id(e))}else{b=Datacell.$editor(a)}}}d.editId=e;d.editor=b;if(b){b.fieldName=d.fieldName;b.hideEditor()}};Datacell.prototype.initCSS=function(){this.viewportXY=getElementXY(this.viewport);var c=[];var b=this;for(var a=0;a<this.fields.length;a++){var d=this.fields[a];d.width=parseInt(d.width||this.defaultColumnWidth);d.styleClass="eos-dc-col-"+this.id+"-"+a;d.rules=createStyle(d.styleClass,document);d.align=d.align||null;d.alignStyle=d.align?"text-align:"+d.align+";":"";c[a]="."+d.styleClass+" { width:"+d.width+"px;  "+d.alignStyle+" }";d.rules.style.width=d.width+"px";if(d.align){d.rules.style.textAlign=d.align}d.allowModify=d.allowModify===undefined||d.allowModify===null?!b.readonly:!!d.allowModify;this.setFieldEditor(d)}if(1==2&&!this.addedCSS){CSSUtil.createStyleSheet(c.join("\n"),this.id+"_style");this.SCROLLBAR_WIDTH=16;this.addedCSS=true}};Datacell.prototype.initAllRows=function(b){if(!b&&this.allTR&&this.allTR.length>0){return this.allTR}this.allTR=[];var c=this.table.tBodies[0].rows;for(var a=0;a<c.length;a++){this.allTR[a]=c[a]}return this.allTR};Datacell.prototype.refreshRowStyle=function(){this.initAllRows(true);var d=this.freezeHeadTable?this.freezeBodyTable.tBodies[0].rows:[];for(var c=0;c<this.allTR.length;c++){var b=this.allTR[c];b.className=b.className.replace(this.rowEvenStyleClass,"");if(c%2==0){b.className=b.className+" "+this.rowEvenStyleClass}else{b.className=b.className.replace(this.rowEvenStyleClass,"")}var a=d[c]||{};a.className=b.className}};Datacell.prototype.getCurrentRowCount=function(){var a=this.table.tBodies[0].rows;return a?a.length:0};Datacell.prototype.getPageRowCount=function(){var a=0;if(this.dataset){a=this.getCurrentRowCount();a=a-(this.dataset.getInsertEntities()?this.dataset.getInsertEntities().length:0);a=a+(this.dataset.getRemovedEntities()?this.dataset.getRemovedEntities().length:0)}return a};Datacell.prototype.getTotalRowCount=function(){if(this.__pagePilot&&this.__pagePilot[0]){return this.__pagePilot[0].count||0}return -1};Datacell.prototype.getAllRows=function(a){this.initAllRows(a);return this.allTR};Datacell.prototype.freezeColumn=function(a){var h=this.freezeHeadTable.tBodies[0].rows;for(var e=0;e<a;e++){var g=this.fields[e];g.frozeHeadCell=this.headTable.tBodies[0].rows[0].cells[e].cloneNode(true);g.frozeSortIcon=g.frozeHeadCell.getElementsByTagName("span")[1];g.frozeSplitter=g.frozeSortIcon.nextSibling;if(h.length>0){h[0].appendChild(g.frozeHeadCell)}}this.initAllRows();h=this.freezeBodyTable.tBodies[0].rows;var f=this.allTR.length;for(var c=h.length;c<f-h.length;c++){var j=this.styleFreezeRow.cloneNode(true);j.className=this.allTR[c].className;j.appendChild(this.styleIndexColumn.cloneNode(true));this.freezeBodyTable.tBodies[0].appendChild(j)}for(var d=0;d<f;d++){for(var e=0;e<a;e++){var b=this.allTR[d].cells[e].cloneNode(true);h[d].appendChild(b)}}};Datacell.prototype.quickSort=function(a,d,e,l,b){var i=this;var c=a;var m=d+1;var j=m;var f=i.allTR;var h=f[a];var k=e(this,h,l);var g;if(b){while(true){while(++c<d&&e(this,f[c],l)>=k){}while(--m>a&&e(this,f[m],l)<=k){}if(c>=m){break}g=f[c];f[c]=f[m];f[m]=g}}else{while(true){while(++c<d&&e(this,f[c],l)<=k){}while(--m>a&&e(this,f[m],l)>=k){}if(c>=m){break}g=f[c];f[c]=f[m];f[m]=g}}f[a]=f[m];f[m]=h;m-=1;if(a<m){i.quickSort(a,m,e,l,b)}m+=2;if(m<d){i.quickSort(m,d,e,l,b)}return f};Datacell.prototype.doSort=function(l){if(!l.sortAt||l.sortAt=="null"||l.sortAt=="none"||l.sortAt=="undefined"){return}this.initAllRows();if(this.allTR.length<1){return}if(this.lastSortField){removeClass(this.lastSortField.sortIcon,"eos-hd-asc");removeClass(this.lastSortField.frozeSortIcon,"eos-hd-asc");removeClass(this.lastSortField.sortIcon,"eos-hd-desc");removeClass(this.lastSortField.frozeSortIcon,"eos-hd-desc")}if(l.sorted=="asc"){l.sorted="desc";addClass(l.sortIcon,"eos-hd-desc");addClass(l.frozeSortIcon,"eos-hd-desc")}else{if(l.sorted=="desc"){l.sorted=""}else{l.sorted="asc";addClass(l.sortIcon,"eos-hd-asc");addClass(l.frozeSortIcon,"eos-hd-asc")}}this.lastSortField=l;if(l.sortAt){l.sortAt=(""+l.sortAt).toLowerCase();if(l.sortAt=="server"||l.sortAt.indexOf("s")==0){if(l.sorted){var a={_orderby:{_property:l.fieldName}};if(l.sorted){a._orderby._sort=l.sorted}this.sortParam=a}else{this.sortParam={}}try{this.endEdit()}catch(j){}var h=0;if(!this.isCount){h=-1}var n=this.setPageParam(0,this.pageSize,h,this.isCount);this.gotoPage(n);return}}if(l.sorted){this.quickSort(0,this.allTR.length-1,Datacell.getSortValue,l.fieldName,l.sorted=="desc")}else{this.quickSort(0,this.allTR.length-1,Datacell.getSortDefaultValue,l.fieldName,l.sorted=="desc")}var o=this.freezeBodyTable.tBodies[0].rows;var f=this.showIndex?1:0;var b=document.createDocumentFragment();for(var g=0;g<this.allTR.length;g++){var k=this.allTR[g];k.className=k.className.replace(this.rowEvenStyleClass,"");if(g%2==0){k.className=k.className+" "+this.rowEvenStyleClass}else{k.className=k.className.replace(this.rowEvenStyleClass,"")}for(var d=0;d<this.freezeNumber;d++){var m=o[g].cells[d+f];var c=k.cells[d].cloneNode(true);o[g].className=k.className;o[g].replaceChild(c,m)}b.appendChild(k)}this.table.tBodies[0].appendChild(b)};Datacell.prototype.initHeadEvent=function(){if(this.hasInitHeadEvent){return}var a=this;var b=a.fields.length;for(var d=0;d<b;d++){var c=a.fields[d];(function(e){eventManager.add(e.splitter,"mousedown",function(f){a.startColumnResize(f,e)});eventManager.add(e.frozeSplitter,"mousedown",function(f){a.startColumnResize(f,e)});eventManager.add(e.headCell,"mouseover",function(f){addClass(e.headCell,"eos-hd-row-over")});eventManager.add(e.frozeHeadCell,"mouseover",function(f){addClass(e.frozeHeadCell,"eos-hd-row-over")});eventManager.add(e.headCell,"mouseout",function(f){removeClass(e.headCell,"eos-hd-row-over")});eventManager.add(e.frozeHeadCell,"mouseout",function(f){removeClass(e.frozeHeadCell,"eos-hd-row-over")});eventManager.add(e.headCell,"click",function(f){a.onClickHead(e.headCell,d,e,a);a.doSort(e)});eventManager.add(e.frozeHeadCell,"click",function(f){a.doSort(e)})})(c)}this.hasInitHeadEvent=true};Datacell.prototype.initHead=function(){this.headTable=$createElement("table",{className:"eos-head-table",cellSpacing:"0",cellPadding:"0",border:"0"});this.headWrap.appendChild(this.headTable);this.headTbody=$createElement("tbody");this.headTable.appendChild(this.headTbody);var b=this.fields.length;var j=[];for(var e=0;e<b;e++){this.keys[this.fields[e].fieldId]=this.fields[e];j.push(this.fields[e].fieldId)}var m=$createElement("tr");m.className="eos-hd-row";this.headTbody.appendChild(m);this.styleRow=$createElement("tr",{className:this.rowStyleClass});this.styleFreezeRow=$createElement("tr",{className:this.rowStyleClass});var d=this.getSubmitXpath();var k=false;if(!this.styleEntity){this.styleEntity=this.styleEntity||new Entity(d);this.styleEntity.id=0;this.styleEntity.__type=this.entityType;k=true}for(var h=0;h<b;h++){var l=$createElement("td");var g=this.fields[h];if(k){this.initStyleField(g)}if(window.isGecko){}l.className=g.styleClass;l.style.textAlign=this.headTextAlign;l.innerHTML=['<div class="eos-hd-inner ',(window.isGecko?"eos-hd-inner-ff ":""),g.styleClass,'" unselectable="on" style="text-align:left;" >',"<span>",g.label,"</span>",'<div class="eos-hd-tool" ><span class="eos-hd-icon"></span><span class="eos-hd-split">&#160;</span></div>',"</div>"].join("");m.appendChild(l);g.headCell=l;g.labelSpan=l.firstChild.firstChild;g.sortIcon=l.getElementsByTagName("span")[1];g.splitter=g.sortIcon.nextSibling;g.splitter.colID=h;g.splitter.style.cursor="col-resize";g.defaultValue=g.defaultValue||"";g.sortAt=g.sortAt||"client";g.nullText=g.nullText||"";g.template=g.expression?compileTemplate(g.expression):null;var a=$createElement("td",{innerHTML:'<div class="eos-inner '+g.styleClass+'"  ></div>',className:g.styleClass});a.setAttribute("name",g.fieldId);this.styleRow.appendChild(a)}var f=false;if(!this.dataset){this.dataset=new Dataset(this.entityName)}var c=0;return};Datacell.prototype.initStyleField=function(b){if(b.editType=="entity"){var a=new Entity(b.fieldName);this.styleEntity.setProperty(b.fieldName,a)}else{if(b.editType=="dataset"){var a=new Dataset(b.fieldName);this.styleEntity.setProperty(b.fieldName,a)}else{if(b.defaultValue!==null&&b.defaultValue!==undefined){this.styleEntity.setProperty(b.fieldName,b.defaultValue)}else{this.styleEntity.setProperty(b.fieldName,"")}}}};Datacell.prototype.initFreezeZone=function(){this.freezeHeadDiv=$createElement("div",{className:"eos-freeze-div"});this.freezeBodyDiv=$createElement("div",{className:"eos-freeze-div"});this.viewport.appendChild(this.freezeHeadDiv);this.viewport.appendChild(this.freezeBodyDiv);this.cTop=0;this.freezeHeadDiv.style.top=this.cTop+"px";this.freezeBodyDiv.style.top=this.cTop+this.headHeight+"px";this.freezeHeadTable=$createElement("table",{id:this.headTable.id+"_freeze",className:"eos-head-table",cellSpacing:"0",cellPadding:"0",border:"0"});this.freezeHeadDiv.appendChild(this.freezeHeadTable)};Datacell.prototype.initBody=function(){var tableStartHTML='<table class="eos-table" cellSpacing="0"  cellPadding="0" border="0" ><tbody>';var trHTML=['<tr class="'+this.rowStyleClass," "+this.rowEvenStyleClass,'" __entity_rowno="','" >\n',"</tr>\n"];var colNum=this.fields.length;var rn=0;var tableHTML=[];var rowHTML;var freezeTableHTML=[tableStartHTML];var indexColumnWidth=this.tableMarginLeft-(isBorderBox?0:2);var indexColumnDivWidth=this.tableMarginLeft;var tdStyleClass=isIE?'style="width:'+this.tableMarginLeft+'px;"':"";var divStyleClass=isIE?"":'style="width:'+(this.tableMarginLeft-(isBorderBox?0:4))+'px;"';var indexColumnCell=['<td class="eos-index-col" '+tdStyleClass+' ><div class="eos-inner" style="width:'+(indexColumnDivWidth-4)+'px" >',"</div></td>"];this.styleIndexColumn=$createElement("td",{className:"eos-index-col"});if(isIE){this.styleIndexColumn.style.width=this.tableMarginLeft+"px"}this.styleIndexColumn.innerHTML='<div class="eos-inner" '+divStyleClass+" >&#160;</div>";if(this.freezeBodyTable){removeElement(this.freezeBodyTable);removeElement(this.freezeHeadTable.tBodies[0])}this.freezeHeadTable.appendChild($createElement("tbody"));if(this.showIndex){var headRow=$createElement("tr",{className:"eos-hd-row"});this.freezeHeadTable.tBodies[0].appendChild(headRow);var colN=$createElement("td",{innerHTML:'<div class="eos-hd-inner'+(window.isGecko?" eos-hd-inner-ff ":"")+'" style="width:'+(indexColumnDivWidth-5)+'px" >&#160;</div>',className:"eos-index-col"});if(isIE){colN.style.width=indexColumnWidth+"px"}headRow.appendChild(colN);this.freezeHeadDiv.style.display="block";this.freezeHeadDiv.style.left="0px"}var datasetLength=!this.dataset?0:this.dataset.getLength();var rowNum=this.pageSize||datasetLength;rowNum=(rowNum<0||datasetLength<rowNum)?datasetLength:rowNum;var colName=[];for(var i=0;i<colNum;i++){colName.push(this.fields[i].fieldId)}tableHTML.push(tableStartHTML);for(rn=0;rn<rowNum;){var entity=this.dataset.get(rn);rowHTML=[[trHTML[0],(rn%2==0?trHTML[1]:""),trHTML[2],rn,trHTML[3]].join("")];if(this.showIndex){freezeTableHTML.push(rowHTML[0]);freezeTableHTML.push(indexColumnCell[0]);freezeTableHTML.push("&#160;"+indexColumnCell[1]);freezeTableHTML.push("</tr>\n")}for(var cn=0;cn<colNum;cn++){var field=this.fields[cn];var cellText=entity.getProperty(field.fieldName);if(field.onRefreshFunc){if(typeof(field.onRefreshFunc)=="string"){field.onRefreshFunc=eval(field.onRefreshFunc)}cellText=field.onRefreshFunc(cellText,entity,rn,cn,this)}else{if(field.expression){cellText=runExpression(field.template,entity)}else{if(field.editor){cellText=htmlConversion(field.editor.getDisplayValue(cellText))}else{cellText=htmlConversion(cellText===undefined||cellText===null?field.nullText:cellText)}}}cellText=cellText===undefined||cellText===null?field.nullText:cellText;rowHTML.push('<td fieldId="');rowHTML.push(colName[cn]);rowHTML.push('" class="');rowHTML.push(field.styleClass);rowHTML.push('"><div class="eos-inner ');rowHTML.push(field.styleClass);rowHTML.push('" >');rowHTML.push(cellText);rowHTML.push("</div></td>")}rowHTML.push(trHTML[4]);tableHTML.push(rowHTML.join(""));rn++}for(var bi=0;bi<this.pageSize-datasetLength;bi++){for(var cn=0;cn<colNum;cn++){}}tableHTML.push('</tbody></table><div style="width:100%;height:1px;font-size:0px;">&nbsp;</div>');this.bodyDiv.innerHTML=tableHTML.join("");this.table=this.bodyDiv.firstChild;this.table.datacell=this;this.tbody=this.table.tBodies[0];this.scrollDiv=this.table.nextSibling;this.scrollDiv.style.width=this.headTable.offsetWidth;this.freezeBodyDiv.innerHTML=freezeTableHTML.join("");this.freezeBodyTable=this.freezeBodyDiv.firstChild;this.isModefied=false;if(this.showIndex){this.headTable.style.marginLeft=this.tableMarginLeft+1+"px";this.table.style.marginLeft=this.tableMarginLeft+1+"px"}else{this.headTable.style.marginLeft=0+"px";this.table.style.marginLeft=0+"px"}this.initAllRows(true);if(this.freezeNumber>0){this.freezeColumn(this.freezeNumber)}this.initHeadEvent();var datacell=this;function tt(){datacell.freezeBodyDiv.style.height=datacell.bodyDivHeight-0+"px";if(datacell.headDiv.clientHeight>10){datacell.freezeBodyDiv.style.height=datacell.bodyDiv.clientHeight+"px"}}return};Datacell.prototype.initStyleRow=function(){if(!this.rowStyles instanceof Array){this.rowStyles=this.rowStyles.split(",")}};Datacell.prototype.locked=function(){this.endEdit();var c=$id(Datacell.BLOLK_ID);var a=$id(Datacell.BLOLK_ID+"_IMG");if(!c){c=$createElement("div");document.body.appendChild(c);c.id=Datacell.BLOLK_ID}if(!a&&PICTURE_BLANK){a=$createElement("img");a.src=PICTURE_BLANK;a.id=Datacell.BLOLK_ID+"_IMG";c.appendChild(a)}c.style.cursor="wait";c.style.position="absolute";c.style.zIndex="1";var b=getPosition(this.container);c.style.top=b.top;c.style.left=b.left;c.style.width=this.container.offsetWidth;c.style.height=this.container.offsetHeight;if(a){a.style.width=c.style.width;a.style.height=c.style.height;a.border="0"}c.style.display="block"};Datacell.prototype.unlocked=function(){var a=$id(Datacell.BLOLK_ID);if(a){a.style.display="none"}};Datacell.prototype.insertEmptyRow=function(){return this.insertRow(this.styleEntity.clone(true))};Datacell.prototype.insertRow=function(b,d){if(typeof d=="number"){d=this.getRowAt(d)}b=b||this.cloneEntity()||this.styleEntity.clone(true);if(d&&b){b.status=Entity.STATUS_NEW;var g=d.rowIndex;removeClass(this.activeCell,"eos-cell-actived");var f=d.cloneNode(true);addClass(this.activeCell,"eos-cell-actived");this.dataset.addEntity(b);this.tbody.insertBefore(f,d);f.setAttribute("__entity_rowno",this.dataset.getLength()-1);var e=this.freezeBodyTable.tBodies[0].rows[g];var c=this.styleFreezeRow.cloneNode(true);c.className=f.className;c.appendChild(this.styleIndexColumn.cloneNode(true));this.freezeBodyTable.tBodies[0].insertBefore(c,e);this.refreshRow(f);this.selectRow(f);this.isModefied=true;if(this.linkId&&this.linkField){var a=PageControl.getOne(this.linkId);if(a){a.isModefied=true}}return f}return this.addRow(b)};Datacell.prototype.addRow=function(b){this.endEdit();if(!this.allowAdd||this.readonly){return null}var f=this.tbody.rows.length;if(f<0){f=0}var e=b||this.styleEntity.clone(true);e.status=Entity.STATUS_NEW;if(!this.dataset){return null}var k=this.styleRow.cloneNode(true);k.setAttribute("__entity_rowno",this.dataset.getLength());if(this.beforeAdd(k)===false){k=null;delete k;return null}this.dataset.addEntity(e);this.tbody.appendChild(k);for(var d=0;d<k.cells.length;d++){k.cells[d].setAttribute("fieldId",this.fields[d].fieldId)}var f=(this.tbody.rows.length+1)%this.rowStyles.length;addClass(k,(this.tbody.rows.length+1)%2==0?this.rowEvenStyleClass:"");var l=this.styleFreezeRow.cloneNode(true);l.className=k.className;l.appendChild(this.styleIndexColumn.cloneNode(true));this.freezeBodyTable.tBodies[0].appendChild(l);for(var d=0;d<this.freezeNumber;d++){var c=k.cells[d].cloneNode(true);c.setAttribute("fieldId",this.fields[d].fieldId);l.appendChild(c)}this.refreshRow(k);this.isModefied=true;this.initAllRows(true);this.bodyDiv.scrollTop=this.bodyDiv.scrollHeight;this.freezeBodyDiv.scrollTop=this.bodyDiv.scrollTop;var g=this;this.selectRow(k);for(var j=0;j<this.fields.length;j++){var h=this.fields[j];if(h.editor){this.setActiveCell(null,k.cells[j]);this.startEdit();break}}if(this.linkId&&this.linkField){var a=PageControl.getOne(this.linkId);if(a){a.isModefied=true}}this.refreshRowStyle();this.afterAdd(k);return k};Datacell.prototype.deleteRow=function(d){if(!this.allowDel||this.readonly){return}d=d===0?0:(d||this.activeRow);if(d==null){return}d=this.getRow(d);if(this.beforeDel(d)!==false&&d){this.selectNextRow();if(this.activeCell){this.endEdit()}if(this.getEntity(d).status==Entity.STATUS_NEW){this.getEntity(d).status=Entity.STATUS_HIDDEN}else{var b=false;if(this.linkId&&this.linkField){var c=PageControl.getOne(this.linkId);if(c){c.isModefied=true;b=true}}this.dataset.removeEntity(this.getEntity(d),b)}var a=this.freezeBodyTable.tBodies[0].rows[d.rowIndex];if(d&&d.parentNode){d.parentNode.removeChild(d)}if(a&&a.parentNode){a.parentNode.removeChild(a)}this.isModefied=true;this.initAllRows(true);this.refreshRowStyle();this.afterDel(d)}};Datacell.prototype.updateEntity=function(a,c,b){a.setProperty(c,b)};Datacell.prototype.getEntity=function(b){var c=b;if(typeof(c)=="number"){c=this.table.tBodies[0].rows[c]}if(!c){return null}if(c.tagName.toLowerCase()=="td"){c=c.parentNode}var d=c.getAttribute("__entity_rowno")/1;var a=this.dataset.get(d);return a};Datacell.prototype.selectRow=function(d,b){this.endEdit();d=this.getRow(d);if(this.beforeSelectRow(d)===false){return false}var e=true;if(this.activeRow!=null){if(this.activeRow==d){e=false}else{if(!this.unSelectRow()){this.afterSelectRow(d);return false}}}this.activeRow=this.activeRow||d;addClass(d,this.rowSelectStyleClass);if(e||b){this.setSubComponent(this.getEntity(d))}var c=this.getEntity(d);this.onSelectRow(d,c);var a=this;if(c){c.__onUpdate=function(){if(a.getEntity(d).status!=Entity.STATUS_NEW){a.getEntity(d).status=Entity.STATUS_MODIFIED}if(a.syncRefresh){a.refreshRow(d)}else{a.refreshCell(a.activeCell,a.activeField)}a.isModefied=true}}this.afterSelectRow(this.activeRow);return true};Datacell.prototype.setSubComponent=function(b){if(this.submitXpath&&b){b.name=this.getSubmitXpath()}var a=this;setTimeout(c,100);function c(){for(var f=0;f<a.__subComponent.length;f++){var d=a.__subComponent[f];try{d.freshFromEntity(b)}catch(g){}}}};Datacell.prototype.freshFromEntity=function(a){if(this.queryAction){if(a){if(this.dataType=="json"){this.queryParam=a.toJson()}else{this.queryParam=a.toString()}}else{this.queryParam=null}this.loadData()}else{if(this.linkField){if(a){this.dataset=a.getProperty(this.linkField);if(!this.dataset){this.dataset=new Dataset(this.linkField);a.setProperty(this.linkField,this.dataset)}}else{this.dataset=new Dataset(this.linkField)}}}this.refresh()};Datacell.prototype.registerSubComponent=function(b){var a=PageControl.getOne(b);this.__subComponent.push(a)};Datacell.prototype.initCell=function(a,b){var c=a.getAttribute("fieldId");if(c==Datacell.__INDEX_NAME){return}var d=this.keys[c];var e=d.fieldName;this.refreshCell(a,d)};Datacell.prototype.refreshRow=function(l,c){var k=l.cells.length;c=c||this.getEntity(l);for(var b=0;b<k;b++){cell=l.cells[b];var h=cell.getAttribute("fieldId");if(h==Datacell.__INDEX_NAME){continue}var f=this.keys[h];var i=f.fieldName;var g=c.getProperty(i)?c.getProperty(i):"";if(c==this.activeEntity&&g!=this.activeEntityBackup.getProperty(i)){try{var a=cell.parentNode.rowIndex;if(this.showIndex){addClass(this.freezeBodyTable.tBodies[0].rows[a].cells[0],"eos-row-modefied")}else{addClass(cell.parentNode,"eos-row-modefied")}}catch(d){addClass(cell.parentNode,"eos-row-modefied")}}this.refreshCell(cell,f)}};Datacell.prototype.refresh=function(){this.init();if(this.beforeRefresh()===false){return}this.activeEditor=null;this.activeCell=null;this.activeRow=null;this.activeField=null;this.activeValue=null;this.initBody();this.status=Datacell.STATUS_BLANK;this.onComplete();this.selectFirstRow();this.afterRefresh()};Datacell.prototype.reSortBody=function(a){var b=this.tbody.cloneNode(false);for(var c=0;c<a.length;c++){b.appendChild(a[c])}this.table.replaceChild(b,this.tbody);this.tbody=b};Datacell.prototype.serverSort=function(a){var b=a.field;a.sortType=a.sortType=="_desc"?"_asc":"_desc";this.sortParam={_orderby:{_property:b.fieldName,_sort:a.sortType}};this.reload()};Datacell.prototype.refreshSortTh=function(a){if(!this.sortArrow){this.sortArrow=$createElement("img")}bodyAddNode(this.sortArrow);a.container.appendChild(this.sortArrow);if(a.sortType=="_desc"){this.sortArrow.src=PICTURE_SORT_DOWN}else{if(a.sortType=="_asc"){this.sortArrow.src=PICTURE_SORT_UP}}};Datacell.prototype.setPageParam=function(b,a,c,e){if(this.dataType=="json"){var d={__type:"sdo:com.eos.foundation.PageCond",begin:b,length:a,count:c,isCount:!!e};this.pageParam={page:d};return this.pageParam}else{this.pageParam='<page __type="sdo:com.eos.foundation.PageCond"><begin>'+b+"</begin><length>"+a+"</length><count>"+c+"</count><isCount>"+(!!e)+"</isCount></page>";return this.pageParam}};Datacell.prototype.initPageParam=function(){if(this.pageSizeList&&this.pageSizeList!="null"&&this.pageSizeList!="none"&&(","+this.pageSizeList+",").indexOf(","+this.pageSize+",")<0){this.pageSizeList+=","+this.pageSize}var a=0;if(!this.isCount){a=-1}this.setPageParam(0,this.pageSize,a,this.isCount)};Datacell.prototype.initAttachParam=function(){};Datacell.prototype.getQueryForm=function(){if(!this.entityType&&!this.entityName&&!this.sortParam){if(this.dataType=="json"){return{}}else{return""}}var b={};var a=this.entityType||this.entityName||"";a=a.split(":");if(a.length==2){b._entity=a[1]}EOS.apply(b,this.sortParam);return this.setCriteriaParam(b)};Datacell.prototype.setCriteriaParam=function(a){var b={__type:"sdo:com.primeton.das.criteria.criteriaType"};EOS.apply(b,a);this.criteriaParam=b;return b};Datacell.prototype.setQueryParam=function(a){this.queryParam=a;return this.queryParam};Datacell.prototype.setJsonDataset=function(json){if(typeof(json)=="string"){json=eval(json)}if(!(json instanceof Dataset)){json=Json2Dataset(json)}this.dataset=json;this.dataXML="<json/>"};Datacell.prototype.loadJsonData=function(){};Datacell.prototype.addParam=function(a,b){this.paramList=this.paramList||[];this.paramList.push({key:a,value:b})};Datacell.prototype.loadData=function(){if(this.beforeLoadData()===false){return}if(this.dataXML=="<json/>"){return}if(!this.linkId&&!this.queryAction&&this.xpath){var xmlZone=document.getElementById(this.id+"_xml");this.dataXML=xmlZone?xmlZone.innerHTML:null}else{if(this.linkId&&this.linkId.indexOf("xml:")==0){var xmlZone=document.getElementById(this.linkId.substring(4));this.dataXML=xmlZone?xmlZone.innerHTML:null}else{if(this.linkId&&this.isFirstLoad){this.isFirstLoad=false;return}}}var xmlDom;if(this.dataXML&&this.dataXML!=="<json/>"){this.dataset=Dataset.create(this.dataXML,this.xpath);xmlDom=createXmlDom();xmlDom.loadXML(this.dataXML);var pagecond=xmlDom.selectSingleNode("/root/data/page");this.freshPagePilot(pagecond);return}if(this.onLoadData()!=false){if(!this.queryAction){return}var ajax=new Ajax(this.queryAction);var param=this.getQueryForm();var paramFn="";if(this.initParamFunc){try{paramFn=eval(this.initParamFunc+"(ajax)")}catch(e){try{paramFn=eval(this.initParamFunc+"()")}catch(e1){$handle(e1)}}}if(this.dataType=="json"){EOS.apply(param,this.queryParam);EOS.apply(param,this.pageParam);EOS.apply(param,paramFn)}else{var queryParma=this.queryParam||"";param+=queryParma;param+=this.pageParam;param+=paramFn}if(this.paramFormId){var form=$id(this.paramFormId);if(form){for(var i=0;i<form.elements.length;i++){var elem=form.elements[i];if(elem.name){ajax.addParam(elem.name,getElementValue(elem))}}}}if(this.paramList){for(var i=0;i<this.paramList.length;i++){var elem=this.paramList[i];if(elem){ajax.addParam(elem.key,elem.value)}}}if(this.queryReturnValue){ajax.setOutParam(this.queryReturnValue)}if(this.queryParamsInfo){ajax.setParamsInfo(this.queryParamsInfo)}if(this.queryInoutParams){ajax.setInoutParam(this.queryInoutParams)}ajax.setDataType(this.dataType);var _this=this;ajax.onSuccess=function(){var pagecond=null;if(_this.dataType=="json"&&ajax.retJson){var xp=_this.xpath;var arr=ajax.retJson;if(xp){xp=xp.split("/");for(var i=0,len=xp.length;i<len;i++){arr=arr[xp[i]]}}_this.dataset=Json2Dataset(arr);pagecond=ajax.retJson.page}else{xmlDom=ajax.retDom;_this.dataset=Dataset.create(xmlDom,_this.xpath,_this.getSubmitXpath());pagecond=xmlDom.selectSingleNode("/root/data/page")}_this.freshPagePilot(pagecond);_this.afterLoadData(ajax)};ajax.loadData(param)}};Datacell.prototype.freshPagePilot=function(e){var h;if(this.dataType=="json"){h=Json2Entity(e)}else{h=Dataset.initEntity(e)}if(!e){var f=1;var c=this.dataset?this.dataset.getLength():0;if(c<f){f=0;c=f}for(var b=0;b<this.__pagePilot.length;b++){var g=this.__pagePilot[b];if(g.gotoPageText){g.gotoPageText.value=1}if(g.pageInfoDiv){g.pageInfoDiv.innerHTML="<nobr>";g.pageInfoDiv.innerHTML+="<nobr>"+this.PAGE_RECORDINFO_NOCOUNT.replace("{0}",f).replace("{1}",this.dataset.getLength())+"</nobr>";g.pageInfoDiv.innerHTML+="</nobr>"}g.freshPilot(h,this.readonly,this.allowAdd,this.allowDel)}return}this.totalPage=Number(h.getProperty("totalPage"));this.begin=Number(h.getProperty("begin"));this.pageSize=Number((!this.pageSize||this.pageSize<1)?h.getProperty("length"):this.pageSize);this.currentPage=Number(h.getProperty("currentPage"));if(parseInt(this.currentPage)<1){this.currentPage=1;h.setProperty("currentPage",1)}var a=Number(h.getProperty("totalPage"));var d=Number(h.getProperty("begin"));if((""+a)!="-1"){this.SortByServer=true}else{if((""+d)=="0"){this.SortByServer=false}else{this.SortByServer=true}}for(var b=0;b<this.__pagePilot.length;b++){var g=this.__pagePilot[b];g.freshPilot(h,this.readonly,this.allowAdd,this.allowDel)}};Datacell.prototype.registerPagePilot=function(a){this.__pagePilot.push(a);a.datacell=this};Datacell.prototype.reload=function(a){a=a!==undefined&&a!==null?a:this.recount;if(a){this.setPageParam(this.begin,this.pageSize,-1,this.isCount)}this.loadData();this.refresh()};Datacell.prototype.selectNextRow=function(){if(this.activeRow){var b=nextElement(this.activeRow);var a=prevElement(this.activeRow);if(b){this.selectRow(b)}else{if(a){this.selectRow(a)}}}};Datacell.prototype.selectPreRow=function(){if(this.activeRow){var b=nextElement(this.activeRow);var a=prevElement(this.activeRow);if(a){this.selectRow(a)}else{if(b){this.selectRow(b)}}}};Datacell.prototype.selectFirstRow=function(){if(this.tbody.rows.length>0){var a=this.tbody.rows[0];this.selectRow(a)}else{this.setSubComponent(null)}};Datacell.prototype.selectLastRow=function(){if(this.tbody.rows.length>0){var a=this.tbody.rows[this.tbody.rows.length-1];this.selectRow(a)}};Datacell.prototype.gotoPage=function(a){if(this.isModefied){if(window.confirm(DATACELL_MODIFY_CONFIRM)){this.submit()}}this.pageParam=a;this.reload();this.onPageChange()};Datacell.prototype.validateAll=function(){var a=this.activeEntity;var m=this.getActiveCell();var b=this.activeRow;for(var d=0;d<this.table.tBodies[0].rows.length;d++){var n=this.table.tBodies[0].rows[d];var c=this.getEntity(n);if(c.status==Entity.STATUS_NEW){this.activeEntity=c;for(var j=0;j<this.fields.length;j++){var k=this.fields[j];if(k.editor){this.activeCell=n.cells[j];this.activeRow=n;var l=c.getProperty(k.fieldName);k.editor.setValue(l);var g;try{g=k.editor.validate()}catch(h){g=false}if(!g){this.activeCell=null;this.setActiveCell(n.cells[j]);this.startEdit();try{g=k.editor.validate()}catch(h){g=false}this.unlocked();this.activeEntity=a;return false}}}}}this.activeEntity=a;this.activeCell=m;this.activeRow=b;return true};Datacell.prototype.save=function(){if(this.beforeSave()!==false){this.submit();this.afterSave()}};Datacell.prototype.submit=function(){if(this.beforeSubmit()===false||!this.submitAction){return}this.locked();this.endEdit();if(!this.isModefied){alert(DATACELL_MODIFY_NO)}else{if(!this.validateAll()){return false}var a=false;if(!a){var g=new HideSubmit(this.submitAction);if(this.paramFormId){var f=$id(this.paramFormId);if(f){for(var c=0;c<f.elements.length;c++){var e=f.elements[c];if(e.name){g.addParam(e.name,xmlConversion(getElementValue(e)))}}}}if(this.paramList){for(var c=0;c<this.paramList.length;c++){var e=this.paramList[c];if(e){g.addParam(e.key,e.value)}}}if(this.submitReturnValue){g.setOutParam(this.submitReturnValue)}if(this.submitParamsInfo){g.setParamsInfo(this.submitParamsInfo)}if(this.submitInoutParams){g.setInoutParam(this.submitInoutParams)}g.loadData(this.dataset.getSubmitXML());if(g.retDom){var d=g.retDom.selectNodes("\rootexception");if(d&&d.length>0){var b=getNodeValue(d[0]);if(b&&(""+b).indexOf("e")>=0){alert(DATACELL_SAVE_ERR)}}}this.afterSubmit(g);this.dataXML=null;this.loadData();this.refresh()}}this.unlocked();return true};Datacell.prototype.reset=function(){};Datacell.prototype.processSortIcon=function(a){};Datacell.prototype.addcheckbox=function(){};Datacell.prototype.setReadonly=function(b){if(b==null){b=true}this.readonly=b;for(var a=0;a<this.fields.length;a++){this.fields[a].allowModify=!this.readonly}};Datacell.prototype.getEntitiesXML=function(b,d){var a=new StringBuffer();if(d.length>0){for(var c=0;c<d.length;c++){d[c].name=b;a.append(d[c].toString())}}return a.toString()};Datacell.prototype.getSubmitXpath=function(){var b=this.submitXpath;if(!b){if(this.xpath){var a=this.xpath.split("/");b=a[a.length-1]}else{if(this.linkField){b=this.linkField}}}return b||"entity"};Datacell.prototype.submitAllByXML=function(){if(this.allEntitiesXMLDiv){this.allEntitiesXMLDiv.parentNode.removeChild(this.allEntitiesXMLDiv)}var c=$createElement("div",{style:{display:"none"}});this.allEntitiesXMLDiv=c;var b=this.getSubmitXpath();var a=$createElement("input",{type:"hidden",name:"insertEntities",value:this.getEntitiesXML(b,this.dataset.getAlltEntities())});c.appendChild(a);this.container.appendChild(c)};Datacell.prototype.submitModifyByXML=function(f,e,b,a){if(!a){this.submitModifyBy3XML(f,e,b);return}if(this.modifyEntitiesXMLDiv){this.modifyEntitiesXMLDiv.parentNode.removeChild(this.modifyEntitiesXMLDiv)}var c=$createElement("div",{style:{display:"none"}});this.modifyEntitiesXMLDiv=c;var d=[];d[0]=this.getEntitiesXML(f||"insertEntities",this.dataset.getInsertEntities());d[1]=this.getEntitiesXML(e||"updateEntities",this.dataset.getModifiedEntities());d[2]=this.getEntitiesXML(b||"deleteEntities",this.dataset.getRemovedEntities());var g=$createElement("input",{type:"hidden",name:a||"modifyEntities",value:d.join("")});c.appendChild(g);this.container.appendChild(c)};Datacell.prototype.submitModifyBy3XML=function(g,f,d){if(this.modifyEntitiesXMLDiv){this.modifyEntitiesXMLDiv.parentNode.removeChild(this.modifyEntitiesXMLDiv)}var e=$createElement("div",{style:{display:"none"}});this.modifyEntitiesXMLDiv=e;var c=$createElement("input",{type:"hidden",name:g||"insertEntities",value:this.getEntitiesXML(g||"insertEntities",this.dataset.getInsertEntities())});var b=$createElement("input",{type:"text",name:f||"updateEntities",value:this.getEntitiesXML(f||"updateEntities",this.dataset.getModifiedEntities())});var a=$createElement("input",{type:"hidden",name:d||"deleteEntities",value:this.getEntitiesXML(d||"deleteEntities",this.dataset.getRemovedEntities())});e.appendChild(c);e.appendChild(b);e.appendChild(a);this.container.appendChild(e)};Datacell.prototype.submitAllByHidden=function(){if(!this.validateAll()){return false}if(this.allEntitiesHiddenDiv){this.allEntitiesHiddenDiv.parentNode.removeChild(this.allEntitiesHiddenDiv)}var c=$createElement("div",{style:{display:"none"}});this.container.appendChild(c);this.allEntitiesHiddenDiv=c;var a=this.dataset.name;var b=this.getSubmitXpath();var d=Dataset2Array(this.dataset,b,true);this.addHiddenByArray(d,c);return true};Datacell.prototype.submitModifyByHidden=function(d,c,a){if(!this.validateAll()){return false}if(this.modifyEntitiesHiddenDiv){this.modifyEntitiesHiddenDiv.parentNode.removeChild(this.modifyEntitiesHiddenDiv)}var b=$createElement("div",{style:{display:"none"}});this.container.appendChild(b);this.modifyEntitiesHiddenDiv=b;var e=Dataset2Array(this.dataset.getInsertDataset(),d||"insertEntities");e=e.concat(Dataset2Array(this.dataset.getModifiedDataset(),c||"updateEntities"));e=e.concat(Dataset2Array(this.dataset.getRemovedDataset(),a||"deleteEntities"));this.addHiddenByArray(e,b);return true};Datacell.prototype.addHiddenByArray=function(d,a){var c=new StringBuffer();for(var b=0;b<d.length;b++){if(d[b].value==null){continue}c.append("<textarea  name='");c.append(d[b].key);c.append("' >");c.append(d[b].value);c.append("</textarea>")}a.innerHTML=c};Datacell.prototype.unSelectRow=function(){var a=this.activeRow;if(!a){return true}else{this.endEdit()}if(this.onUnSelectRow(a,this.getEntity(a))){removeClass(a,this.rowSelectStyleClass);this.activeRow=null;return true}else{return false}};Datacell.prototype.onUnSelectRow=function(b,a){return true};Datacell.prototype.setValue=function(a){this.dataset=a;$info("datacell setvalue "+a);this.refresh()};Datacell.prototype.getValue=function(){return this.dataset};Datacell.prototype.setFocus=function(){};Datacell.prototype.lostFocus=function(){this.endEdit()};function Pilot(a){this.id=a;PageControl.add(a,this);this.container=null;this.currPage=1;this.totalPages=null;this.currRecord=null;this.totalRecords=null;this.width="100%";this.height="100%";this.inputClass="INPUT";this.readonly=false;this.addButton=null;this.deleteButton=null;this.firstPageButton=null;this.nextPageButton=null;this.prePageButton=null;this.lastPageButton=null;this.gotoPageText=null;this.gotoPageButton=null;this.saveButton=null;this.reloadButton=null;this.begin=0;this.length=10;this.count=-1;this.isCount=false;this.totalPage=-1;this.currentPage=-1;this.isLast=false;this.isFirst=true;this.first_able=true;this.pre_able=true;this.next_able=true;this.last_able=true;this.add_able=true;this.delete_able=true}Datacell.prototype.setCustomTool=function(b,a){var a=a||this.__pagePilot[0].id;this.customToolHTML=b;var c=$id(a+"_custom_zone");if(c){c.innerHTML=this.customToolHTML;return true}return false};Datacell.prototype.hiddenButtons=function(a){};Pilot.prototype.init=function(){};Pilot.prototype.build=function(){if(this.datacell.toolbarLocation=="top"){this.container=this.datacell.topToolbarDiv}else{this.container=this.datacell.bottomToolbarDiv}var b=this.datacell;var v=b.toolsList.split(",");str=[];var g=(""+this.datacell.pageSizeList)!="none"&&(""+this.datacell.pageSizeList)!="null";for(var r=0;r<v.length;r++){var a=v[r].split(":");var f=a[1]||null;a=a[0];if(f){f=" "+f+" "}switch(a){case"nav":str=str.concat(['<div class="eos-tool-zone" id="'+this.id+'_nav_zone" >',(f&&f.indexOf(" first ")<0)?"":'<a title="'+TOOLTIP_FIRST_PAGE+'" id="'+this.id+'_first" href="javascript:void(0);"><div class="eos-grid-tool-first"></div></a>',(f&&f.indexOf(" prev ")<0)?"":'<a title="'+TOOLTIP_PRIVOUS_PAGE+'" id="'+this.id+'_previous" href="javascript:void(0);"><div class="eos-grid-tool-prev"></div></a>',(f&&f.indexOf(" next ")<0)?"":'<a title="'+TOOLTIP_NEXT_PAGE+'" id="'+this.id+'_next" href="javascript:void(0);"><div class="eos-grid-tool-next"></div></a>',(f&&f.indexOf(" last ")<0)?"":'<a title="'+TOOLTIP_LAST_PAGE+'" id="'+this.id+'_last" href="javascript:void(0);"><div class="eos-grid-tool-last"></div></a>',(f&&f.indexOf(" goto ")<0)?"":'<input type="text" size="3" maxlength="4" class="eos-grid-tool-goto-input" id="'+this.id+'_input" /><a title="'+TOOLTIP_GOTO+'" id="'+this.id+'_goto" href="javascript:void(0);" style="margin-left:0px;"><div class="eos-grid-tool-goto"></div></a>',"</div>"]);break;case"pagesize":if(g){str=str.concat(["<div >",'<div class="eos-grid-tool-pageinfo" id="'+this.id+'_pagesize"  >',"</div>","</div>"])}break;case"custom":str=str.concat(['<div class="eos-tool-zone" id="'+this.id+'_custom_zone" >',b.customToolHTML||"","</div>"]);break;case"edit":str=str.concat(['<div class="eos-tool-zone">',(f&&f.indexOf(" add ")<0)?"":'<a title="'+TOOLTIP_ADD+'" id="'+this.id+'_add" href="javascript:void(0);"><div class="eos-grid-tool-add"></div></a>',(f&&f.indexOf(" del ")<0)?"":'<a title="'+TOOLTIP_DELETE+'" id="'+this.id+'_del" href="javascript:void(0);"><div class="eos-grid-tool-del"></div></a>',(f&&f.indexOf(" save ")<0)?"":'<a title="'+TOOLTIP_SAVE+'" id="'+this.id+'_save" href="javascript:void(0);"><div class="eos-grid-tool-save"></div></a>',(f&&f.indexOf(" reload ")<0)?"":'<a title="'+TOOLTIP_RELOAD+'" id="'+this.id+'_reload" href="javascript:void(0);"><div class="eos-grid-tool-reload"></div></a>',"</div>"]);break;case"info":str=str.concat(['<div class="eos-tool-zone">','<div class="eos-grid-tool-pageinfo" id="'+this.id+'_pageinfo"  >',"</div>","</div>"]);break}}this.container.innerHTML=str.join("\n");this.firstPageButton=$id(this.id+"_first");this.nextPageButton=$id(this.id+"_next");this.prePageButton=$id(this.id+"_previous");this.lastPageButton=$id(this.id+"_last");this.gotoPageText=$id(this.id+"_input");this.gotoPageButton=$id(this.id+"_goto");var q=$id(this.id+"_pagesize");if(g&&q){var l={};var p=this.datacell.pageSizeList.split(",");for(var r=0;r<p.length;r++){l[p[r]]=p[r]}this.pageSizeSelect=createSelect(l,this.datacell.pageSize);this.pageSizeSelect.id=this.id+"_size";this.pageSizeSelect.className="eos-pagesize-select";q.appendChild(this.pageSizeSelect)}this.addButton=$id(this.id+"_add");this.deleteButton=$id(this.id+"_del");this.saveButton=$id(this.id+"_save");this.reloadButton=$id(this.id+"_reload");this.pageInfoDiv=$id(this.id+"_pageinfo");var t=this;if(g&&this.pageSizeSelect){function j(){t.datacell.endEdit();t.datacell.pageSize=Number(t.pageSizeSelect.value);t.gotoPage(1)}eventManager.add(this.pageSizeSelect,"change",j)}function c(){var i=eventManager.getKeyCode();if(i==27){eventManager.stopEvent();t.gotoInputPage()}}eventManager.add(this.gotoPageText,"keypress",c);function h(){t.addRow()}eventManager.add(this.addButton,"click",h);function d(){b.endEdit();t.deleteRow()}eventManager.add(this.deleteButton,"click",d);function e(){b.endEdit();if(t.firstPageButton._disabled){return}t.gotoFirstPage()}eventManager.add(this.firstPageButton,"click",e);function o(){b.endEdit();if(t.nextPageButton._disabled){return}t.gotoNextPage()}eventManager.add(this.nextPageButton,"click",o);function k(){b.endEdit();if(t.prePageButton._disabled){return}t.gotoPrePage()}eventManager.add(this.prePageButton,"click",k);function u(){b.endEdit();if(t.lastPageButton._disabled){return}t.gotoLastPage()}eventManager.add(this.lastPageButton,"click",u);function w(){b.endEdit();if(t.gotoPageButton._disabled){return}t.gotoInputPage()}eventManager.add(this.gotoPageButton,"click",w);function s(){eventManager.stopEvent();b.endEdit();if(t.saveButton._disabled){return}var x=false;for(var y=0;y<t.datacell.fields.length;y++){if(t.datacell.fields[y].allowModify==true){x=true;break}}if(!x){return}t.datacell.save()}eventManager.add(this.saveButton,"click",s);function m(){b.endEdit();if(t.reloadButton._disabled){return}var i=true;if(t.datacell.isModefied&&confirm(DATACELL_MODIFY_CONFIRM)){t.datacell.submit()}else{t.datacell.reload()}}eventManager.add(this.reloadButton,"click",m);function n(){t.clearup()}eventManager.add(window,"unload",n)};Pilot.prototype.freshPilot=function(a,i,j,g){var f=true;var d=true;var h=true;var m=true;var c=false;if(a){c=true;this.begin=parseInt(a.getProperty("begin"))||0;this.datacell.pageSize=Number(this.datacell.pageSize<1?parseInt(a.getProperty("length")):this.datacell.pageSize);this.count=parseInt(a.getProperty("count"));this.datacell.isCount=(a.getProperty("isCount")=="true");this.totalPage=parseInt(a.getProperty("totalPage"));this.currentPage=parseInt(a.getProperty("currentPage"))||1;this.isLast=(a.getProperty("isLast")=="true");this.isFirst=(a.getProperty("isFirst")=="true");this.currentPage=this.currentPage<1?1:this.currentPage;if(!this.datacell.isCount){this.currentPage=parseInt(this.begin/this.datacell.pageSize)+1}var e=isNaN(this.currentPage/1)||this.currentPage<1?1:this.currentPage;var l=isNaN(this.totalPage/1)||this.totalPage<1?1:this.totalPage;var k=isNaN(this.count/1)||this.count<0?0:this.count;var b=Number(isNaN(this.begin/1)||this.begin<0?0:this.begin)+1;var n=b+this.datacell.pageSize-1;n=n>k?k:n;n=n<b?b:n;if(this.gotoPageText){this.gotoPageText.value=e}if(this.pageInfoDiv){this.pageInfoDiv.innerHTML="<nobr>";if(!this.datacell.isCount||k<0){this.pageInfoDiv.innerHTML+="<nobr>"+this.datacell.PAGE_RECORDINFO_NOCOUNT.replace("{0}",b).replace("{1}",n)+"</nobr>"}else{this.pageInfoDiv.innerHTML+=this.datacell.PAGE_RECORDINFO.replace("{0}",b).replace("{1}",n).replace("{2}",k);this.pageInfoDiv.innerHTML+="&#160;&#160;<nobr>"+this.datacell.PAGE_INFO.replace("{0}",l)+"</nobr>"}this.pageInfoDiv.innerHTML+="</nobr>"}}if(this.firstPageButton){this.firstPageButton._disabled=this.isFirst||!c}if(this.prePageButton){this.prePageButton._disabled=this.isFirst||!c}if(this.nextPageButton){this.nextPageButton._disabled=this.isLast||!c}if(this.lastPageButton){this.lastPageButton._disabled=this.isLast||this.count<0||!c}if(this.isFirst||!c){setOpacity(this.firstPageButton,0.5);setOpacity(this.prePageButton,0.5)}else{setOpacity(this.firstPageButton,1);setOpacity(this.prePageButton,1)}if(this.isLast||!c){setOpacity(this.nextPageButton,0.5);setOpacity(this.lastPageButton,0.5)}else{setOpacity(this.nextPageButton,1);setOpacity(this.lastPageButton,1)}if(this.count<0||!c){setOpacity(this.lastPageButton,0.5)}if(!c||!a.getProperty("begin")){if(this.gotoPageButton){this.gotoPageButton._disabled=true;this.gotoPageText.disabled=true;setOpacity(this.gotoPageButton,0.5)}}};Pilot.prototype.clearup=function(){for(var b in this){try{this[b]=null}catch(a){$handle(a)}}};Pilot.prototype.gotoPage=function(a){a=Number(a);if(isNaN(a)){a=1}a=parseInt(a,10);this.currentPage=a;if(a<1){a=1}var d=(a-1)*Number(this.datacell.pageSize);if(d<0){d=0}var c=this.count;if(!this.datacell.isCount){c=-1}var b=this.datacell.setPageParam(d,this.datacell.pageSize,c,this.datacell.isCount);this.datacell.gotoPage(b)};Pilot.prototype.gotoInputPage=function(){var a=Number(this.gotoPageText.value);if(isNaN(a)){alert(DATACELL_PAGENUM_ERR)}else{this.gotoPage(a)}};Pilot.prototype.gotoFirstPage=function(){if(this.first_able){this.gotoPage(1)}};Pilot.prototype.gotoNextPage=function(){if(this.next_able){this.gotoPage(this.getCurrPage()+1)}};Pilot.prototype.gotoPrePage=function(){if(this.pre_able){this.gotoPage(this.getCurrPage()-1)}};Pilot.prototype.gotoLastPage=function(){if(this.last_able){this.gotoPage(this.getPageCount())}};Pilot.prototype.addRow=function(){this.datacell.addRow()};Pilot.prototype.deleteRow=function(){this.datacell.deleteRow()};Pilot.prototype.reloadData=function(){this.datacell.reload()};Pilot.prototype.submit=function(){this.datacell.submit()};Pilot.prototype.setButton=function(g,f,c,e,b,a,d){if(g){this.first_able=true;this.firstPageButton.src=this.iconPath+PICTURE_FIRST_BUTTON}else{this.first_able=false;this.firstPageButton.src=this.iconPath+PICTURE_FIRST_DISABLE}if(f){this.pre_able=true;this.prePageButton.src=this.iconPath+PICTURE_PRIVOUS_BUTTON}else{this.pre_able=false;this.prePageButton.src=this.iconPath+PICTURE_PRIVOUS_DISABLE}if(c){this.next_able=true;this.nextPageButton.src=this.iconPath+PICTURE_NEXT_BUTTON}else{this.next_able=false;this.nextPageButton.src=this.iconPath+PICTURE_NEXT_DISABLE}if(e){this.last_able=true;this.lastPageButton.src=this.iconPath+PICTURE_LAST_BUTTON}else{this.last_able=false;this.lastPageButton.src=this.iconPath+PICTURE_LAST_DISABLE}if(a||b){this.addButton.src=this.iconPath+PICTURE_ADD_DISABLE}else{this.addButton.src=this.iconPath+PICTURE_ADD_BUTTON}if(!d||b){this.deleteButton.src=this.iconPath+PICTURE_DELETE_DISABLE}else{this.deleteButton.src=this.iconPath+PICTURE_DELETE_BUTTON}};Pilot.prototype.getPageCount=function(){return this.totalPage};Pilot.prototype.getCurrPage=function(){return this.currentPage};Datacell.prototype.rowMoveUp=function(f){f=f||this.activeRow;if(!f){return}var b=f.parentNode;var a=f.rowIndex;var c=f.getAttribute("__entity_rowno");if(a<1){return}var e=b.rows[a-1];var d=e.getAttribute("__entity_rowno");b.insertBefore(f,e)};Datacell.prototype.rowMoveDown=function(f){f=f||this.activeRow;if(!f){return}var b=f.parentNode;var a=f.rowIndex;var c=f.getAttribute("__entity_rowno");if(a>=b.rows.length-1){return}var e=b.rows[a+1];var d=e.getAttribute("__entity_rowno");b.insertBefore(e,f)};Datacell.prototype.getActiveRow=function(){return this.activeRow};Datacell.prototype.getActiveCell=function(){return this.activeCell};Datacell.prototype.getActiveEntity=function(){return this.getEntity(this.getActiveRow())};Datacell.prototype.showEditor=function(){PageControl.addtoStack(this);this.datacellContainer.style.display="";this.datacellContainer.onmousedown=function(){eventManager.stopEvent()}};Datacell.prototype.hideEditor=function(){if(this.activeEditor){this.activeEditor.hideEditor()}if(this.datacellContainer){this.datacellContainer.style.display="none";this.datacellContainer.onmousedown=null}};Datacell.prototype.hide=function(){this.hideEditor()};Datacell.prototype.setPosition=function(c,a,b,f){this.datacellContainer.style.position="absolute";var e=getMaxZindex();var d=getMaxZindex(document);if(this.datacellContainer.style.zIndex!=d){this.datacellContainer.style.zIndex=d}setElementXY(this.datacellContainer,[c,a])};Datacell.prototype.getDisplayValue=function(a){return a};Datacell.prototype.isFocus=function(){return false};Datacell.prototype.validate=function(){return true};Datacell.prototype.onSelectRow=function(b,a){};Datacell.prototype.onDeleteRow=function(b,a){return true};Datacell.prototype.onSubmit=function(){return true};Datacell.prototype.onAddRow=function(a){return true};Datacell.prototype.onUpdateCell=function(){};Datacell.prototype.onLoadData=function(){return true};Datacell.prototype.onUpdateRow=function(a){return true};Datacell.prototype.onUpdate=function(){return true};Datacell.prototype.beforeInit=function(){};Datacell.prototype.afterInit=function(){};Datacell.prototype.beforeLoadData=function(){};Datacell.prototype.afterLoadData=function(){};Datacell.prototype.beforeRefresh=function(){};Datacell.prototype.afterRefresh=function(){};Datacell.prototype.beforeSubmit=function(){};Datacell.prototype.afterSubmit=function(){};Datacell.prototype.beforeSubmit=function(){};Datacell.prototype.beforeSave=function(){};Datacell.prototype.afterSave=function(){};Datacell.prototype.beforeRefreshCell=function(){};Datacell.prototype.beforeAdd=function(){};Datacell.prototype.afterAdd=function(){};Datacell.prototype.beforeEdit=function(a,c,b){};Datacell.prototype.afterEdit=function(c,b,a){};Datacell.prototype.beforeDel=function(){};Datacell.prototype.afterDel=function(){};Datacell.prototype.beforeSelectRow=function(){};Datacell.prototype.afterSelectRow=function(){};Datacell.prototype.beforeUnselectRow=function(){};Datacell.prototype.afterUnselectRow=function(){};Datacell.prototype.onComplete=function(){};Datacell.prototype.onPageChange=function(){};Datacell.prototype.onClickHead=function(b,c,d,a){};Datacell.prototype.onClickCell=function(d,c,e,b,f,a){};Datacell.prototype.onClickRow=function(c,d,b,a){};Datacell.activeGrid=null;Datacell.STATUS_BLANK=0;Datacell.STATUS_INITED=1;Datacell.STATUS_MODEFIED=2;Datacell.BLOLK_ID="__DATACELL_BLOCK";Datacell.__INDEX_NAME="__INDEX";Datacell.outClick=function(k,l,f){var d=k.datacell;var b=d.editorContainer;if(b&&l){var h=f.x;var g=f.y;var j=getPosition(b);var e=j.top;var c=j.left;var i=c+b.offsetWidth;var a=e+b.offsetHeight;if(!b.contains(l)){if(e>g||c>h||i<h||a<g){d.endEdit()}}}else{d.endEdit()}};Datacell.isCell=function(c){if(c&&c.tagName){var a=c.tagName.toLowerCase()=="td";var b=c.getAttribute("fieldId");if(b&&a){return true}return false}return false};Datacell.isHead=function(c){if(c.tagName){var a=c.tagName.toLowerCase()=="th";var b=c.getAttribute("__type")=="head";if(b&&a){return true}return false}return false};Datacell.getDatacellByCell=function(b){try{var c=getParentByTagName(b,"table");var a=c.datacell;return a}catch(d){$handle(d);return null}};Datacell.checkCell=function(j,c,d,i,f,g,e){var a="",h=e;if(j==g){a="checked";h=g}h=h||h===0?h:"";var b="fieldFunc_"+f.id+"_"+i;Datacell[b]=function(k){var l=f.fields[i].fieldName;if(k.checked){c.setProperty(l,g)}else{c.setProperty(l,e)}};return'<input type="checkbox" '+a+' value="'+(""+h).replace(/\"/igm,'\\"').replace(/\n/igm,"\\n")+'"  onclick="Datacell[\''+b+"'](this)\"  />"};Datacell.checkCellHandler=function(a){};Datacell.getFormatValue=function(a,b){if(isDateFormat(b)){if(isTimeFormat(b)){return dateFormat(a,DATETIME_FORMAT,b)}else{return dateFormat(a,DATE_FORMAT,b)}}else{if(isTimeFormat(b)){return timeFormat(a,TIME_FORMAT,b)}else{return formatNumber(a,b)}}};Datacell.$editor=function(a){if(!a||(a&&a.getValue)){return a}return SimpleEditor(a)};Datacell.getSortValue=function(a,c,e){var d=a.dataset.get(c.getAttribute("__entity_rowno")/1).getProperty(e);var b=d?Number(d):d;d=isNaN(b)?d:b;return d};Datacell.getSortDefaultValue=function(a,b,c){return b.getAttribute("__entity_rowno")/1};function getDatacellRoot(b){var a=getParentByTagName(b,"table");if(a){if(a.className&&a.className.indexOf("eos-grid-container")!=-1){return a}else{if(a){return getDatacellRoot(a)}}}else{return null}}Datacell.initGlobalEvent=function(){eventManager.add(document,"keydown",function(a){Datacell.activeGrid&&Datacell.activeGrid._onKeyDown(a)});eventManager.add(document.body,"click",function(b){var a=b.srcElement||b.target;if(!getDatacellRoot(a)){Datacell.activeGrid=null}});eventManager.add(document.body,"mousemove",function(a){Datacell.activeGrid&&Datacell.doDocGridHandler(a,Datacell.activeGrid)});eventManager.add(document.body,"mouseup",function(a){Datacell.activeGrid&&Datacell.endDocGridHandler(a,Datacell.activeGrid)})};Datacell.doDocGridHandler=function(b,a){b=b||window.event;var c=eventManager.getPointX();if(a.splitLine.style.display=="block"){var d=c-a.viewportXY[0];a.splitLine.style.left=d+"px"}else{}};Datacell.endDocGridHandler=function(c,a){c=c||window.event;var g=eventManager.getPointX();if(a.splitLine.style.display=="block"){var f=a.resizeColumn;f.newRightX=g-a.viewportXY[0];var e=f.newRightX-f.oldRightX;var b=parseInt(CSSUtil.getRule("."+f.styleClass,true).style.width);var d=e+b;a.setColumnWidth(f,d);a.resizeColumn=false;a.splitLine.style.display="none";a.headDiv.style.cursor="auto";a.gridMask.style.cursor="auto";a.gridMask.style.display="none";a.syncScroll()}else{}};Datacell.onWindowResize=function(a){if(_eos_curr_open_panel!=null){if(!a.isInCurrPanel()){return}}a.autoResizeS1()};Datacell.prototype.autoResizeS1=function(){var a=this;a.bodyDivHeight=a.containerTD.offsetHeight-a.headHeight;a.bodyDivWidth=a.containerTD.offsetWidth;var b=false;if(a.width.indexOf("%")!=-1){b=true}if(a.height.indexOf("%")!=-1){a.container.style.height="100%";a.bodyDiv.style.height="1px";a.freezeBodyDiv.style.height=a.bodyDiv.clientHeight+"px";b=true}else{if(a.bodyDivHeight>0){a.bodyDiv.style.height=a.bodyDivHeight+"px"}if(a.bodyDiv.clientHeight>0){}}if(b){setTimeout(function(){a.autoResize()},1)}else{a.syncScroll()}};Datacell.prototype.autoResizeS2=function(){var a=this;a.bodyDivHeight=a.containerTD.offsetHeight-a.headHeight;a.bodyDivWidth=a.containerTD.offsetWidth;if(a.height.indexOf("%")!=-1){if(a.bodyDivHeight>0){a.bodyDiv.style.height=a.bodyDivHeight+"px"}if(a.bodyDiv.clientHeight>0){a.freezeBodyDiv.style.height=a.bodyDiv.clientHeight+"px"}}if(a.width.indexOf("%")!=-1){if(a.bodyDivWidth>0){a.bodyDiv.style.width=a.bodyDivWidth+"px"}}};Datacell.prototype.autoResize=Datacell.prototype.autoResizeS2;Datacell.prototype.isInCurrPanel=function(){if(_eos_curr_open_panel!=null){var a=this.datacellContainer.offsetParent;while(true){if(a==null){return false}if(a==_eos_curr_open_panel.table){return true}a=a.offsetParent}}else{return false}};Datacell.createSwidthCheckBox=function(h,d,a,i,e){var g=e.getField(i);var f=g.checkedValue;var c=g.unCheckedValue;var b="";if(f==h){b="checked"}return'<input type="checkbox" '+b+' swidthCheckbox="true"/>'};