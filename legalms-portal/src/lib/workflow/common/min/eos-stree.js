function Relation(b,a,c,d){this.entityName=b;this.entityField=a;this.parentEntity=c;this.parnetFeild=d}function EntityInfo(g,c,d,i,f,b,h,a,e){this.icon=g;this.iconType=c;this.showField=d;this.onclick=i;this.refresh=f;this.oncheck=b;this.submitXpath=h;this.url=a;this.target=e}function CheckedInfo(c,b,a,d){this.entityName=c;this.entityField=b;this.checkedEntity=a;this.checkedField=d}function CheckList(a){this.entityType=a;this.list=new Array()}CheckList.prototype.push=function(a){this.list.push(a)};CheckList.prototype.getLength=function(){return this.list.length};CheckList.prototype.getNodeType=function(){return this.entityType};CheckList.prototype.toString=function(){var b="";for(var a=0;a<this.list.length;a++){b=b+this.list[a]}return"<list entityType='"+this.entityType+"'>"+b+"</list>"};function STree(f,c,b,e,d,a){if(d!="null"){f.style.width=d}if(a!="null"){f.style.height=a}var g=f.id.substr(0,f.id.indexOf("_container"));PageControl.add(g,this);this.hasCheckbox=c;this.checkType=b;this.treeContainer=f;this.hasRoot=e;this.datasetList=new Object();this.datasetList.root=new Object();this.entityInfoList=new Object();this.relationList=new Array();this.checkedInfoList=new Array()}STree.prototype.addRelation=function(b,a,d,e){var c=new Relation(b,a,d,e);this.relationList.push(c)};STree.prototype.addCheckedInfo=function(c,b,a,e){var d=new CheckedInfo(c,b,a,e);this.checkedInfoList.push(d)};STree.prototype.addDataset=function(b,a){var d=createXmlDom();d.loadXML(a.innerHTML);var c=new Dataset(b);c.init(d.selectSingleNode("/root/data").childNodes);this.datasetList[b]=c};STree.prototype.addEntityInfo=function(h,g,c,d,k,f,b,i,a,e){var j=new EntityInfo(g,c,d,k,f,b,i,a,e);this.entityInfoList[h]=j};STree.prototype.getDataset=function(a){return this.datasetList[a]};STree.prototype.getEntityInfo=function(a){return this.entityInfoList[a]};STree.prototype.processRelation=function(){var c=this.relationList;for(var a=0;a<c.length;a++){var b=c[a];if(b.parentEntity=="root"){_stree_linkToRoot(b,this.getDataset(b.entityName),this.getDataset(b.parentEntity))}else{_stree_linkToParnet(b,this.getDataset(b.entityName),this.getDataset(b.parentEntity))}}};STree.prototype.processCheckBox=function(){var n=this.checkedInfoList;for(var e=0;e<n.length;e++){var l=n[e];if(l.entityName==l.checkedEntity){var d=this.getDataset(l.entityName);var a=d.values;var m=l.checkedField;var p=l.entityField;var r=d.getLength();for(var c=0;c<r;c++){var q=a[c].getProperty(p);if(q==m){a[c].checked="1"}}}else{var d=this.getDataset(l.entityName);var a=d.values;var r=d.getLength();var o=this.getDataset(l.checkedEntity);var g=o.values;var f=o.getLength();var p=l.entityField;var h=l.checkedField;for(var c=0;c<r;c++){var q=a[c].getProperty(p);for(var b=0;b<f;b++){var m=g[b].getProperty(h);if(m==q){a[c].checked="1"}}}}}this.processParnetCheckBox()};STree.prototype.processParnetCheckBox=function(){if(this.checkType=="simple"){return}_stree_processParnetCheckBox(this.getDataset("root"))};function _stree_processParnetCheckBox(a){var e="3";var d=a.childList;if(d!=null){for(var b=0;b<d.length;b++){var c=_stree_processParnetCheckBox(d[b]);if(e=="3"){e=c}else{if(e!="2"){if(e!=c){e=2}}}}a.checked=e;return e}else{if(a.checked=="1"){return 1}else{return 0}}}function _stree_linkToRoot(a,d,l){if(l.childList==null){l.childList=new Array()}var f=l.childList;var h=d.getLength();var b=d.values;var e=a.entityName;var j=a.parnetFeild;var k=a.entityField;if(j==="ADD_ALL"){for(var g=0;g<h;g++){var c=b[g];c.type=e;f.push(c)}}else{if(j===""){j="null"}for(var g=0;g<h;g++){var c=b[g];if(c.getProperty(k)+""==j){c.type=e;f.push(c)}}}}function _stree_linkToParnet(a,d,k){if(k.childList==null){k.childList=new Array()}var f=k.childList;var h=d.getLength();var b=d.values;var e=a.entityName;var j=a.parnetFeild;if(j==="ADD_ALL"){for(var g=0;g<h;g++){var c=b[g];c.type=e;f.push(c)}}else{__linkToParent(a,d,k)}}function __linkToParent(e,h,l){var o=h.getLength();var u=l.getLength();var n=e.entityName;var t=e.parnetFeild;var c=t.split(",");var m=e.entityField.split(",");var s=c.length;var d=l.values;var a=h.values;for(var r=0;r<o;r++){for(var q=0;q<u;q++){var b=false;for(var p=0;p<s;p++){var g=d[q].getProperty(c[p]);var f=a[r].getProperty(m[p]);if(g!=f){b=false;break}if(p==(s-1)){b=true}}if(b){if(d[q].childList==null){d[q].childList=new Array()}a[r].type=n;d[q].childList.push(a[r])}}}}function _streeNode_collapseNode(){this.expandIcon.src=this.plusIconSrc;this.icon.src=this.closeIconSrc;this.childrenContainer.style.display="none"}function _streeNode_expandNode(){this.expandIcon.src=this.minusIconSrc;this.icon.src=this.openIconSrc;if(!this.isChildLoaded){this.addChildNode()}else{this.childrenContainer.style.display=""}}function _streeNode_addChildNodes(){var c=this.entity.childList;if(c==null){return}for(var b=0;b<c.length;b++){var a=false;var e=false;if(b==0){a=true}if(b==c.length-1){e=true}var d=new STreeNode(this,c[b],a,e);d.refresh();this.childrenContainer.appendChild(d)}this.childrenContainer.style.display="";this.isChildLoaded=true}function STreeRootNode(i){var a=document.createElement("DIV");a.noWrap=true;a.level="";a.tree=i;a.hasCheckbox=i.hasCheckbox;a.checkType=i.checkType;a.entity=i.datasetList.root;a.openIconSrc=STREE_DEFAULTOPEN_ICON;a.closeIconSrc=STREE_DEFAULTCLOSE_ICON;a.plusIconSrc=STREE_ROOTPLUS_ICON;a.minusIconSrc=STREE_FMINUS_ICON;a.entityInfo=i.getEntityInfo("root");a.hasChild=(a.entity.childList!=null);a.isChildLoaded=true;a.isRoot=true;var g=document.createElement("div");var b=a.entityInfo.icon;if(b!=""){a.openIconSrc=_stree_addContextPath(b)}var d;d=document.createElement("IMG");d.style.verticalAlign="middle";if(a.openIconSrc=="null"){d.style.display="none"}d.src=a.openIconSrc;g.appendChild(d);var c=null;if(a.hasCheckbox){c=document.createElement("IMG");c.style.verticalAlign="middle";if(a.entity.checked==null||a.entity.checked=="0"){c.src=STREE_CHECKBOX_FALSE_ICON}else{if(a.entity.checked=="1"){c.src=STREE_CHECKBOX_TRUE_ICON}else{c.src=STREE_CHECKBOX_TRUE_ICON1}}g.appendChild(c)}var h;if(a.entityInfo.url!=""){h=document.createElement("A");h.href=_stree_addContextPath(a.entityInfo.url);h.innerHTML=a.entityInfo.showField;if(a.entityInfo.target!=""){h.target=a.entityInfo.target}}else{h=document.createElement("SPAN");h.innerHTML=a.entityInfo.showField}h.className="RC_TREE_CELL";g.appendChild(h);var f=document.createElement("IMG");f.style.verticalAlign="middle";f.src=STREE_BLANK_ICON;g.appendChild(f);var e=document.createElement("DIV");a.appendChild(g);a.appendChild(e);a.setAttribute("richclientType","RTREENODE");a.icon=d;a.cell=h;a.checkbox=c;a.childLoaded=true;if(!i.hasRoot){g.style.display="none"}a.childrenContainer=e;a.addChildNode=_streeNode_addChildNodes;a.expandNode=_streeNode_expandNode;a.collapseNode=_streeNode_collapseNode;a.select=_streeNode_selected;a.refresh=_streeNode_refresh;a.setIcon=_streeNode_setIcon;a.setText=_streeNode_setNodeText;a.getText=_streeNode_getNodeText;a.getProperty=_streeNode_getProperty;a.checkbox_click=_streeNode_checkbox_onchick;a.getParent=_streeNode_getParent;a.getChildren=_streeNode_getChildren;a.isChecked=_streeNode_isChecked;a.getEntity=_streeNode_getEntity;a.isRootNode=_streeNode_isRoot;a.hasChildNode=_streeNode_hasChild;a.getTree=_streeNode_getTree;a.onmouseover=_streeNode_onmouseover;a.onmouseout=_streeNode_onmouseout;a.onclick=_streeNode_onclick;return a}function STreeNode(b,d,f,c){var a=b.tree;var e=document.createElement("DIV");e.noWrap=true;e.level=b.level;e.tree=a;e.hasCheckbox=a.hasCheckbox;e.checkType=a.checkType;e.entity=d;e.openIconSrc=STREE_DEFAULTOPEN_ICON;e.closeIconSrc=STREE_DEFAULTCLOSE_ICON;e.plusIconSrc="";e.minusIconSrc="";e.entityInfo=a.getEntityInfo(e.entity.type);e.hasChild=(d.childList!=null);e.isRoot=false;_streeNode_processNodeStatus(e,d,f,c);e.addChildNode=_streeNode_addChildNodes;e.expandNode=_streeNode_expandNode;e.collapseNode=_streeNode_collapseNode;e.select=_streeNode_selected;e.refresh=_streeNode_refresh;e.setIcon=_streeNode_setIcon;e.setText=_streeNode_setNodeText;e.getText=_streeNode_getNodeText;e.getProperty=_streeNode_getProperty;e.checkbox_click=_streeNode_checkbox_onchick;e.getParent=_streeNode_getParent;e.getChildren=_streeNode_getChildren;e.isChecked=_streeNode_isChecked;e.getEntity=_streeNode_getEntity;e.isRootNode=_streeNode_isRoot;e.hasChildNode=_streeNode_hasChild;e.getTree=_streeNode_getTree;e.onmouseover=_streeNode_onmouseover;e.onmouseout=_streeNode_onmouseout;e.onclick=_streeNode_onclick;return e}function _streeNode_getTree(){return this.tree}function _streeNode_hasChild(){return this.hasChild}function _streeNode_isRoot(){return this.isRoot}function _streeNode_getEntity(){return this.entity}function _streeNode_getProperty(a){return this.entity.getProperty(a)}function _streeNode_processNodeStatus(c,f,o,j){var a=c.level;var d=c.entityInfo.icon;var e=c.entityInfo.iconType;if(d!=""){var k=d.split(",");if(e=="xpath"){if(k.length!=2){c.openIconSrc=_stree_addContextPath(f.getProperty(k[0]));c.closeIconSrc=c.openIconSrc}else{c.openIconSrc=_stree_addContextPath(f.getProperty(k[0]));c.closeIconSrc=_stree_addContextPath(f.getProperty(k[1]))}}else{if(k.length!=2){c.openIconSrc=_stree_addContextPath(k[0]);c.closeIconSrc=c.openIconSrc}else{c.openIconSrc=_stree_addContextPath(k[0]);c.closeIconSrc=_stree_addContextPath(k[1])}}}if(a==""&&!c.tree.hasRoot&&o){if(j){c.plusIconSrc=STREE_ROOTPLUS_ICON;c.minusIconSrc=STREE_ROOTMINUS_ICON}else{if(c.hasChild){c.plusIconSrc=STREE_FPLUS_ICON;c.minusIconSrc=STREE_FMINUS_ICON}else{c.plusIconSrc=STREE_FLEAF_ICON;c.minusIconSrc=""}}}else{if(j){if(c.hasChild){c.plusIconSrc=STREE_LPLUS_ICON;c.minusIconSrc=STREE_LMINUS_ICON}else{c.plusIconSrc=STREE_LLEAF_ICON;c.minusIconSrc=""}}else{if(c.hasChild){c.plusIconSrc=STREE_PLUS_ICON;c.minusIconSrc=STREE_MINUS_ICON}else{c.plusIconSrc=STREE_LEAF_ICON;c.minusIconSrc=""}}}var q=document.createElement("div");for(var g=0;g<a.length;g++){var b=document.createElement("IMG");b.style.verticalAlign="middle";if(a.charAt(g)=="1"){b.src=STREE_LINE_ICON}else{b.src=STREE_BLANK_ICON}q.appendChild(b)}if(j){c.level=a+"0"}else{c.level=a+"1"}var b=document.createElement("IMG");b.src=c.plusIconSrc;b.style.verticalAlign="middle";q.appendChild(b);var l;l=document.createElement("IMG");l.style.verticalAlign="middle";if(c.closeIconSrc=="null"){l.style.display="none"}l.src=c.closeIconSrc;q.appendChild(l);var h=null;if(c.hasCheckbox){h=document.createElement("IMG");h.style.verticalAlign="middle";if(c.entity.checked==null||c.entity.checked=="0"){h.src=STREE_CHECKBOX_FALSE_ICON}else{if(c.entity.checked=="1"){h.src=STREE_CHECKBOX_TRUE_ICON}else{h.src=STREE_CHECKBOX_TRUE_ICON1}}q.appendChild(h)}var p;if(c.entityInfo.url!=""){p=document.createElement("A");var n=compileTemplate(c.entityInfo.url);p.href=_stree_addContextPath(runExpression(n,f));if(c.entityInfo.target!=""){p.target=c.entityInfo.target}}else{p=document.createElement("span")}p.innerHTML=c.entity.getProperty(c.entityInfo.showField);p.className="RC_TREE_CELL";p.style.verticalAlign="middle";q.appendChild(p);var m=document.createElement("DIV");m.style.display="none";c.appendChild(q);c.appendChild(m);c.setAttribute("richclientType","RTREENODE");b.style.cursor="hand";c.expandIcon=b;c.icon=l;c.cell=p;c.checkbox=h;c.childLoaded=false;c.childrenContainer=m}function _stree_addContextPath(a){if(a==null){return""}if(a.indexOf("/")==0){return contextPath+a}else{return a}}function _streeNode_refresh(){var functionName=this.entityInfo.refresh;if(functionName!=""){eval(functionName+"(this)")}}function _streeNode_onmouseover(){addClass(this.cell,"RC_TREE_MOUSEOVER");eventManager.stopPropagation()}function _streeNode_onmouseout(){removeClass(this.cell,"RC_TREE_MOUSEOVER");eventManager.stopPropagation()}function _streeNode_onclick(){var src=eventManager.getElement();if(src==this.cell||src==this.expandIcon||src==this.icon||src==this.checkbox){this.select()}if(src==this.cell){var functionName=this.entityInfo.onclick;if(functionName!=""){eval(functionName+"(this)")}}if(src==this.expandIcon){if(this.childrenContainer.style.display=="none"){if(this.hasChild){this.expandNode()}}else{this.collapseNode()}}if(src==this.checkbox){this.checkbox_click()}}function _streeNode_checkbox_onchick(){if(this.checkType=="simple"){if(this.entity.checked=="1"){this.entity.checked=0;this.checkbox.src=STREE_CHECKBOX_FALSE_ICON}else{this.entity.checked=1;this.checkbox.src=STREE_CHECKBOX_TRUE_ICON}}else{if(this.entity.checked=="1"){_stree_uncheckAllChild(this)}else{_stree_checkAllChild(this)}_stree_process_parentNode(this)}var functionName=this.entityInfo.oncheck;if(functionName!=""){eval(functionName+"(this)")}}function _stree_checkAllChild(b){b.entity.checked=1;b.checkbox.src=STREE_CHECKBOX_TRUE_ICON;if(b.hasChild){if(b.isChildLoaded){var c=b.getChildren();for(var a=0;a<c.length;a++){_stree_checkAllChild(c[a])}}else{var c=b.entity.childList;for(var a=0;a<c.length;a++){_stree_unload_checkAllChild(c[a])}}}return}function _stree_unload_checkAllChild(a){a.checked=1;if(a.childList){var c=a.childList;for(var b=0;b<c.length;b++){_stree_unload_checkAllChild(c[b])}}return}function _stree_uncheckAllChild(b){b.entity.checked=0;b.checkbox.src=STREE_CHECKBOX_FALSE_ICON;if(b.hasChild){if(b.isChildLoaded){var c=b.getChildren();for(var a=0;a<c.length;a++){_stree_uncheckAllChild(c[a])}}else{var c=b.entity.childList;for(var a=0;a<c.length;a++){_stree_unload_uncheckAllChild(c[a])}}}return}function _stree_unload_uncheckAllChild(a){a.checked=0;if(a.childList){var c=a.childList;for(var b=0;b<c.length;b++){_stree_unload_uncheckAllChild(c[b])}}return}function _stree_process_parentNode(d){var a=d.getParent();if(a==null){return}var c=d.entity.checked;if(c=="2"){a.entity.checked="2";a.checkbox.src=STREE_CHECKBOX_TRUE_ICON1;_stree_process_parentNode(a);return}var e=a.getChildren();for(var b=0;b<e.length;b++){if(e[b].entity.checked==null){e[b].entity.checked="0"}if(e[b].entity.checked!=c){a.entity.checked="2";a.checkbox.src=STREE_CHECKBOX_TRUE_ICON1;_stree_process_parentNode(a);return}}if(c=="1"){a.entity.checked=1;a.checkbox.src=STREE_CHECKBOX_TRUE_ICON}else{a.entity.checked=0;a.checkbox.src=STREE_CHECKBOX_FALSE_ICON}_stree_process_parentNode(a)}function _streeNode_getChildren(){return this.childrenContainer.childNodes}function _streeNode_getParent(){if(this.isRoot){return null}else{return this.parentNode.parentNode}}function _streeNode_selected(){var a=this.tree;if(a.cur_node){a.cur_node.cell.className="RC_TREE_CELL"}this.cell.className="RC_TREE_ACTIVENODE";a.cur_node=this}STree.prototype.getCheckedList=function(e){if(e!=null){var h=this.getDataset(e);if(h==null){alert(e+STREE_ENTITY_NOT_EXIST);return}var b=new CheckList(e);var a=h.values;var g=h.getLength();for(var c=0;c<g;c++){var d=a[c].checked;if(d=="1"||d=="2"){b.push(a[c])}}return b}else{var f=new Array();for(e in this.datasetList){if(e=="root"){continue}var h=this.getDataset(e);if(h==null){alert(e+STREE_ENTITY_NOT_EXIST);return}var b=new CheckList(e);var a=h.values;var g=h.getLength();for(var c=0;c<g;c++){var d=a[c].checked;if(d=="1"||d=="2"){b.push(a[c])}}f.push(b)}return f}};STree.prototype.getUncheckedList=function(e){if(e!=null){var h=this.getDataset(e);if(h==null){alert(e+STREE_ENTITY_NOT_EXIST);return}var b=new CheckList(e);var a=h.values;var g=h.getLength();for(var c=0;c<g;c++){var d=a[c].checked;if(d=="0"||d==null){b.push(a[c])}}return b}else{var f=new Array();for(e in this.datasetList){if(e=="root"){continue}var h=this.getDataset(e);if(h==null){alert(e+STREE_ENTITY_NOT_EXIST);return}var b=new CheckList(e);var a=h.values;var g=h.getLength();for(var c=0;c<g;c++){var d=a[c].checked;if(d=="0"||d==null){b.push(a[c])}}f.push(b)}return f}};STree.prototype.init=function(){this.processRelation();this.processCheckBox();var a=new STreeRootNode(this);this.rootNode=a;a.refresh();this.treeContainer.appendChild(a);var b=document.createElement("div");this.treeContainer.appendChild(b);this.hidden=b;a.addChildNode();if(isFF){if(registerTopContainer(this.treeContainer.parentNode)){EOSResizeObjects.push(this)}}};STree.prototype.getRootNode=function(){return this.rootNode};STree.prototype.getSelectedNode=function(){return this.cur_node};function _streeNode_setIcon(a,b){this.openIconSrc=_stree_addContextPath(a);if(b){this.closeIconSrc=_stree_addContextPath(b)}else{this.closeIconSrc=this.openIconSrc}if(this.closeIconSrc=="null"){this.icon.style.display="none"}this.icon.src=this.closeIconSrc}function _streeNode_isChecked(){var a=this.entity.checked;if(a=="1"||a=="2"){return true}else{return false}}function _streeNode_setNodeText(a){this.cell.innerHTML=a}function _streeNode_getNodeText(){return this.cell.innerHTML}STree.prototype.createHiddenData=function(){var e=new StringBuffer();for(entityType in this.datasetList){if(entityType=="root"){continue}var f=1;var b=this.getDataset(entityType);if(b==null){alert(entityType+STREE_ENTITY_NOT_EXIST);return}var a=b.values;var j=b.getLength();for(var d=0;d<j;d++){var g=a[d].checked;if(g=="1"||g=="2"){var h=a[d].type;var c=this.getEntityInfo(h).submitXpath;if(c!=""){h=c}e.append(_stree_create_hiddenStr(f,a[d],h));f=f+1}}}this.hidden.innerHTML=e};function _stree_create_hiddenStr(d,c,b){var a=new StringBuffer();var f=c.getKeys();for(var e=0;e<f.length;e++){var g=c.getProperty(f[e]);a.append("<input type='hidden' name='").append(b).append("[").append(d).append("]/").append(f[e]).append("' value='").append(g).append("'/>")}return a}STree.prototype.autoResizeS1=function(){this.treeContainer.parentNode.style.display="none"};STree.prototype.autoResizeS2=function(){var a=this.treeContainer.parentNode;var b=a.parentNode;while(b!=null){if(b.getAttribute&&b.getAttribute("layout")!=null){a.style.height=b.offsetHeight;b=null}else{b=b.parentNode}}a.style.display=""};STree.prototype.isInCurrPanel=function(){if(_eos_curr_open_panel!=null){var a=this.treeContainer.offsetParent;while(true){if(a==null){return false}if(a==_eos_curr_open_panel.table){return true}a=a.offsetParent}}else{return false}};